var f=(c,l,r)=>new Promise((y,u)=>{var F=d=>{try{g(r.next(d))}catch(R){u(R)}},b=d=>{try{g(r.throw(d))}catch(R){u(R)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(F,b);g((r=r.apply(c,l)).next())});import{u as ae,B as le}from"./useForm.98d7b8ca.js";import{P as ne}from"./index.8d0858e7.js";import{cy as K,r as C,l as re,G as H,b as ue,u as ce,cJ as de,ch as pe,dk as me,aG as he,q as fe,x as U,o as v,c as N,i as a,A as s,j as e,I as ve,d5 as ye,d6 as Fe,U as D,D as p,t as x,f as S,cS as be,bN as j,e as m,ao as ge,ap as we,am as _e,cM as ke}from"./index.10ef4608.js";/* empty css                *//* empty css               *//* empty css               *//* empty css              *//* empty css               */import{u as xe,B as Ce}from"./useTable.a143d40c.js";import"./TableAction.edf9a202.js";import{u as Re,B as Be}from"./index.c8f8ec06.js";import{C as W}from"./index.866ec2c8.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               */import"./index.b6ac86eb.js";import"./useAttrs.1d381a3e.js";/* empty css                *//* empty css                */import"./uuid.2429c801.js";/* empty css                */import"./useModalContext.52c86736.js";import"./download.66a6d137.js";import"./index.504b494d.js";/* empty css               */import"./onMountedOrActivated.0d13b2a6.js";import"./useWindowSizeFn.3e5b045d.js";import"./useContentViewHeight.9302814f.js";import"./icon-remark.1929ee0a.js";import"./useSortable.79752a2a.js";/* empty css                */import"./modal-error.7cada6d5.js";const Ee=c=>K.get({url:"/minio/pictureQueryByPage",params:c}),G=c=>K.post({url:"/minio/pictureRemoveBatch",data:c}),Ae=c=>K.post({url:"/minio/pictureUpdateBatch",data:c});function Pe(c,l,r){const{createMessage:y}=H(),u=C([]);return{hasBatchDelete:re(()=>u.value.length<=0),selectionOptions:{rowKey:"id",clickToRowSelect:!1,rowSelection:{onSelect:(w,E,T)=>{const A=T.map(P=>P.id);u.value=A},onSelectAll:(w,E,T)=>{const A=E.map(P=>P.id);u.value=A},type:"checkbox"}},handleDeleteOrBatchDelete:(w=null)=>f(this,null,function*(){r({loading:!0});try{w?(yield c({pictureIds:[w.id]}),y.success("\u5220\u9664\u6210\u529F")):(yield c({pictureIds:u.value}),y.success("\u6279\u91CF\u5220\u9664\u6210\u529F"),u.value=[])}finally{r({loading:!1}),l()}}),resetSelectedRowKeys:()=>{u.value=[]},selectedRowIds:u}}const De=p("\u4FEE\u6539\u6570\u636E"),Se={class:"px-4 min-h-96 max-h-[64vh] overflow-hidden overflow-y-auto"},Te={style:{width:"49%"}},Ie=p(" \xA0 "),Me={style:{width:"49%"}},Oe=m("br",null,null,-1),Ue={class:"flex justify-center items-center relative"},Ne={class:""},Ke=p("\u4E00\u952E\u590D\u5236\u5168\u90E8\u94FE\u63A5"),Ve=p("\u4E00\u952E\u590D\u5236\u56FE\u7247\u94FE\u63A5"),$e=p("\u4E00\u952E\u590D\u5236R\u6587\u4EF6\u94FE\u63A5"),ze={class:"absolute top-0 right-0"},je=p("\u5173\u95ED"),We=["src"],Ct=ue({__name:"index",setup(c){const{t:l}=ce(),{hasPermission:r}=de(),y=new Date,u=new Date,F=C(!1),b=C(!1),g=C(),d=C();y.setMonth(y.getMonth()-1),u.setMonth(u.getMonth()+1);const R=pe.RangePicker,V=C(),w=C(),{createMessage:E}=H(),[T,{openModal:A}]=Re(),[P,{setProps:$,reload:B,getSelectRows:I,clearSelectedRowKeys:L}]=xe({columns:[{title:l("pictureFile.serial"),dataIndex:"id",width:150},{title:l("pictureFile.imgFileName"),width:150,sorter:!0,dataIndex:"picArchivePicFilename"},{title:l("pictureFile.rFileName"),width:150,sorter:!0,dataIndex:"picArchiveRFilename"},{title:l("pictureFile.createAuthor"),width:150,sorter:!0,dataIndex:"nickname"},{title:l("pictureFile.updateTime"),width:150,sorter:!0,dataIndex:"updateTime"}],api:Ee,afterFetch:n=>n,useSearchForm:!0,searchInfo:{},formConfig:{showActionButtonGroup:!1,labelWidth:0,schemas:[{field:"keyword",component:"Input",label:"",slot:"input",colProps:{style:{width:"300px"}}},{field:"times",component:"RangePicker",label:" ",labelWidth:60,colProps:{style:{width:"300px"}},slot:"createTime"}],actionColOptions:{span:10}},bordered:!0,clickToRowSelect:!1,isTreeTable:!1,striped:!0,showIndexColumn:!1,canResize:!0,actionColumn:{width:200,title:l("pictureFile.operation"),slots:{customRender:"action"},fixed:"right"}}),[Q,{resetFields:q}]=ae({labelWidth:100,schemas:[{field:"picArchivePicFilename",component:"Input",label:"\u6587\u4EF6\u540D\u79F0",colProps:{span:24}}],submitButtonOptions:{text:"\u786E\u8BA4"},actionColOptions:{offset:14,span:10}}),J=n=>f(this,null,function*(){const{success:t}=yield G({pictureIds:[n.id]});t&&E.success("\u5220\u9664\u6210\u529F"),setTimeout(()=>{B()},200)}),X=n=>f(this,null,function*(){Ae({id:V.value.id,picArchivePicFilename:n.picArchivePicFilename}),q(),setTimeout(()=>{B()},200),A(!1)}),Y=()=>f(this,null,function*(){w.value=yield I()}),Z=()=>f(this,null,function*(){const n=yield I();n.forEach((t,h)=>{setTimeout(()=>{const o=document.createElement("iframe");o.style.display="none",o.style.height="0",o.src=t.picArchiveRFilepath,document.body.appendChild(o),setTimeout(()=>{o.remove()},1e3)},(h+1)*300)}),n.forEach((t,h)=>{setTimeout(()=>{const o=document.createElement("iframe");o.style.display="none",o.style.height="0",o.src=t.picArchivePicFilepath,document.body.appendChild(o),setTimeout(()=>{o.remove()},1e3)},(h+1)*300)}),L()}),ee=n=>{b.value=!0,d.value=n},{hasBatchDelete:M,handleDeleteOrBatchDelete:te,selectionOptions:ie}=Pe(G,B,$),{clipboardRef:oe,isSuccessRef:se}=me(),O=n=>f(this,null,function*(){const h=(yield I()).map(o=>n==="picture"?o.picArchivePicFilepath:n==="RFile"?o.picArchiveRFilepath:o.picArchivePicFilepath+`
`+o.picArchiveRFilepath);oe.value=h.join(`
`),e(se)&&E.success(l("Message.successfullyCopyText"))});return he(()=>{$(ie)}),fe(()=>f(this,null,function*(){})),(n,t)=>{const h=U("CustomButton"),o=U("a-button"),z=U("a-typography-link");return v(),N("div",null,[a(e(ne),{contentFullHeight:!0},{default:s(()=>[a(e(Ce),{onRegister:e(P)},{"form-input":s(({model:i,field:_})=>[a(e(ve),{value:i[_],"onUpdate:value":k=>i[_]=k,allowClear:"",onPressEnter:t[0]||(t[0]=k=>e(B)()),placeholder:e(l)("pictureFile.inputSearch"),onChange:t[1]||(t[1]=({type:k})=>{k=="click"&&e(B)()})},{prefix:s(()=>[a(e(ye))]),_:2},1032,["value","onUpdate:value","placeholder"])]),"form-createTime":s(({model:i,field:_})=>[a(e(R),{value:i[_],"onUpdate:value":k=>i[_]=k,onChange:t[2]||(t[2]=k=>e(B)()),separator:"-"},{suffixIcon:s(()=>[a(e(Fe))]),_:2},1032,["value","onUpdate:value"])]),tableTitle:s(()=>[e(r)(["pictureFile:share"])?(v(),D(h,{key:0,size:"middle",shape:"round",onClick:t[3]||(t[3]=()=>{F.value=!0,g.value=[],Y()}),style:{background:"#3152ed",color:"#ffffff",border:"1px solid #666666",margin:"0px 0px",borderRadius:"4px"},disabled:e(M)},{default:s(()=>[p(x(e(l)("pictureFile.share")),1)]),_:1},8,["disabled"])):S("v-if",!0),e(r)(["pictureFile:download"])?(v(),D(h,{key:1,size:"middle",shape:"round",onClick:t[4]||(t[4]=()=>{g.value=[],Z()}),disabled:e(M),style:{background:"#fff",color:"#202020",border:"1px solid #666666",borderRadius:"4px",margin:"0px 10px"}},{default:s(()=>[p(x(e(l)("pictureFile.download")),1)]),_:1},8,["disabled"])):S("v-if",!0),e(r)(["pictureFile:del"])?(v(),D(h,{key:2,size:"middle",shape:"round",disabled:e(M),onClick:t[5]||(t[5]=()=>{e(W)({onOk:()=>{e(te)(null)}})}),style:{background:"#fff",color:"#202020",border:"1px solid #666666",borderRadius:"4px"}},{default:s(()=>[p(x(e(l)("mom.deletes")),1)]),_:1},8,["disabled"])):S("v-if",!0)]),action:s(({record:i})=>[e(r)(["pictureFile:view"])?(v(),D(o,{key:0,type:"link",onClick:()=>{ee(i)}},{default:s(()=>[p(x(e(l)("pictureFile.previewData")),1)]),_:2},1032,["onClick"])):S("v-if",!0),e(r)(["pictureFile:del"])?(v(),D(o,{key:1,type:"link",onClick:()=>{e(W)({onOk:()=>{J(i)}})}},{default:s(()=>[p(x(e(l)("pictureFile.delete")),1)]),_:2},1032,["onClick"])):S("v-if",!0)]),_:1},8,["onRegister"]),a(e(Be),{onRegister:e(T),showCancelBtn:!1,showOkBtn:!1},{default:s(()=>[a(e(be),{canExpan:!1},{title:s(()=>[De]),default:s(()=>[a(e(le),{onRegister:e(Q),onSubmit:X},null,8,["onRegister"])]),_:1})]),_:1},8,["onRegister"]),a(e(j),{visible:F.value,"onUpdate:visible":t[10]||(t[10]=i=>F.value=i),title:"\u5171\u4EAB\u6570\u636E",width:"60%"},{footer:s(()=>[m("div",Ue,[m("div",Ne,[a(o,{type:"primary",onClick:t[6]||(t[6]=i=>O("all"))},{default:s(()=>[Ke]),_:1}),a(o,{type:"primary",onClick:t[7]||(t[7]=i=>O("picture"))},{default:s(()=>[Ve]),_:1}),a(o,{type:"primary",onClick:t[8]||(t[8]=i=>O("RFile"))},{default:s(()=>[$e]),_:1})]),m("div",ze,[a(o,{type:"primary",onClick:t[9]||(t[9]=i=>F.value=!1)},{default:s(()=>[je]),_:1})])])]),default:s(()=>[m("div",Se,[(v(!0),N(ge,null,we(w.value,(i,_)=>(v(),N("div",{key:i.id,style:{boxShadow:"0 0 5px #c7c7c7"},class:_e(["flex justify-around mb-5 border w-full p-2",{"mt-5":_===0}])},[m("div",Te,[m("h4",null,"\u56FE\u7247\u540D\u79F0:"+x(i.picArchivePicFilename),1),a(z,{copyable:"",style:{width:"86%"},href:i.picArchivePicFilepath,target:"_blank",ellipsis:!0,content:i.picArchivePicFilepath},null,8,["href","content"])]),Ie,m("div",Me,[m("h4",null,"\u6587\u4EF6\u540D\u79F0:"+x(i.picArchiveRFilename),1),a(z,{copyable:"",style:{width:"86%"},href:i.picArchiveRFilepath,target:"_blank",ellipsis:!0,content:i.picArchiveRFilepath},null,8,["href","content"])]),Oe],2))),128))])]),_:1},8,["visible"]),a(e(j),{visible:b.value,"onUpdate:visible":t[11]||(t[11]=i=>b.value=i),title:"\u9884\u89C8\u6570\u636E",onOk:t[12]||(t[12]=()=>{b.value=!1})},{default:s(()=>[a(e(ke),{hoverable:!0,bodyStyle:{padding:"10px",margin:"10px",minHeight:"80px"}},{cover:s(()=>[m("img",{alt:"example",src:d.value.picArchivePicFilepath},null,8,We)]),_:1})]),_:1},8,["visible"])]),_:1})])}}});export{Ct as default};
