var W=Object.defineProperty;var R=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var U=(l,s,t)=>s in l?W(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t,T=(l,s)=>{for(var t in s||(s={}))I.call(s,t)&&U(l,t,s[t]);if(R)for(var t of R(s))H.call(s,t)&&U(l,t,s[t]);return l};var P=(l,s,t)=>new Promise((a,d)=>{var b=n=>{try{c(t.next(n))}catch(u){d(u)}},m=n=>{try{c(t.throw(n))}catch(u){d(u)}},c=n=>n.done?a(n.value):Promise.resolve(n.value).then(b,m);c((t=t.apply(l,s)).next())});import{a as K,r as y,l as L,ay as q,q as Q,x as _,o as S,c as C,f as w,i as f,A as v,y as X,z as Y,e as k,D as A,t as Z,ao as $,ap as ee,am as B,aG as M}from"./index.10ef4608.js";import{m as te}from"./add.f693dce6.js";import"./spark-md5.2cc5764b.js";import{m as oe}from"./mitt.550594b0.js";import"./useSetFrom.689ec4a2.js";var j=oe();const se={name:"GlobalUploader",props:{global:{type:Boolean,default:!0},params:{type:Object},options:{type:Object}},emits:["fileAdded","fileSuccess"],setup(l,{emit:s}){const t={target:"http://localhost:3000/uploadsss",chunkSize:"2048000",fileParameterName:"file",maxChunkRetries:3,testChunks:!0,checkChunkUploadedByResponse:function(e,o){let r=!1;try{let i=JSON.parse(o);i.skipUpload?r=!0:r=(i.uploaded||[]).indexOf(e.offset+1)>=0}catch(i){}return r},query:(e,o)=>T({},e.params)},a={success:"\u4E0A\u4F20\u6210\u529F",error:"\u4E0A\u4F20\u5931\u8D25",uploading:"\u4E0A\u4F20\u4E2D",paused:"\u5DF2\u6682\u505C",waiting:"\u7B49\u5F85\u4E0A\u4F20"},d=y(!1),b=y(!1),m=y(),c=y();let n=te;const u=L(()=>{var e;return(e=m.value)==null?void 0:e.uploader});let g={};q(()=>l.params,e=>{e&&(g=e)}),q(()=>l.options,e=>{e&&setTimeout(()=>{F(e)},0)});function F(e){e.target&&(u.value.opts.target=e.target),e.testChunks!==void 0&&(u.value.opts.testChunks=e.testChunks),e.mergeFn&&(n=e.mergeFn),e.accept&&document.querySelector("#global-uploader-btn input").setAttribute(e.accept,accept.join())}function x(e){return P(this,null,function*(){d.value=!0,N("fileAdded"),e.params=g.value,console.log(e)})}function p(e,o,r,i){let h=JSON.parse(r);if(!h.result){E(h.message),O(o.id,"failed");return}h.needMerge?(O(o.id,"merging"),n(T({tempName:h.tempName,fileName:o.name},o.params)).then(J=>{N("fileSuccess"),V(o.id)}).catch(J=>{})):(N("fileSuccess"),console.log("\u4E0A\u4F20\u6210\u529F"))}function z(e,o,r){console.log(`\u4E0A\u4F20\u4E2D ${o.name}\uFF0Cchunk\uFF1A${r.startByte/1024/1024} ~ ${r.endByte/1024/1024}`)}function D(e,o,r,i){E(r)}function G(){u.value.cancel(),d.value=!1}function O(e,o){const r={md5:{text:"\u6821\u9A8CMD5",bgc:"#fff"},merging:{text:"\u5408\u5E76\u4E2D",bgc:"#e2eeff"},transcoding:{text:"\u8F6C\u7801\u4E2D",bgc:"#e2eeff"},failed:{text:"\u4E0A\u4F20\u5931\u8D25",bgc:"#e2eeff"}};M(()=>{const i=document.createElement("p");i.className=`custom-status-${e} custom-status`,i.innerText=r[o].text,i.style.backgroundColor=r[o].bgc,document.querySelector(`.file_${e} .uploader-file-status`).appendChild(i)})}function V(e){M(()=>{document.querySelector(`.custom-status-${e}`).remove()})}function N(e){j.emit(e),s(e)}function E(e){ElNotification({title:"\u9519\u8BEF",message:e,type:"error",duration:2e3})}return Q(()=>{j.on("openUploader",({params:e={},options:o={}})=>{g=e,F(o),c.value&&c.value.$el.click()})}),{initOptions:t,fileStatusText:a,panelShow:d,collapse:b,uploaderRef:m,uploadBtnRef:c,onFileAdded:x,onFileSuccess:p,onFileProgress:z,onFileError:D,close:G}}},ae=A("\u9009\u62E9\u6587\u4EF6"),le={class:"file-title"},ne=k("div",{class:"title"},"\u6587\u4EF6\u5217\u8868",-1),re={class:"operate"},ie=A("\u5173\u95ED"),ce={class:"file-list"},ue={key:0,class:"no-file"};function de(l,s,t,a,d,b){const m=_("uploader-unsupport"),c=_("uploader-btn"),n=_("Button"),u=_("uploader-file"),g=_("uploader-list"),F=_("uploader");return S(),C("div",{id:"global-uploader",class:B({"global-uploader-single":!t.global})},[w(" \u4E0A\u4F20 "),f(F,{ref:"uploaderRef",class:"uploader-app",options:a.initOptions,"file-status-text":a.fileStatusText,"auto-start":!1,onFileAdded:a.onFileAdded,onFileSuccess:a.onFileSuccess,onFileProgress:a.onFileProgress,onFileError:a.onFileError},{default:v(()=>[f(m),f(c,{id:"global-uploader-btn",ref:"uploadBtnRef"},{default:v(()=>[ae]),_:1},512),X(f(g,null,{default:v(({fileList:x})=>[k("div",{class:B(["file-panel",{collapse:a.collapse}])},[k("div",le,[ne,k("div",re,[f(n,{link:"",onClick:s[0]||(s[0]=p=>a.collapse=!a.collapse)},{default:v(()=>[A(Z(a.collapse?"\u5C55\u5F00":"\u6298\u53E0"),1)]),_:1}),f(n,{link:"",onClick:a.close},{default:v(()=>[ie]),_:1},8,["onClick"])])]),k("ul",ce,[(S(!0),C($,null,ee(x,p=>(S(),C("li",{key:p.id,class:B(["file-item",`file-${p.id}`])},[f(u,{ref_for:!0,ref:"files",class:B("file_"+p.id),file:p,list:!0},null,8,["class","file"])],2))),128)),x.length?w("v-if",!0):(S(),C("div",ue,[w(' <Icon icon="ri:file-3-line" width="16" /> \u6682\u65E0\u5F85\u4E0A\u4F20\u6587\u4EF6 ')]))])],2)]),_:1},512),[[Y,a.panelShow]])]),_:1},8,["options","file-status-text","onFileAdded","onFileSuccess","onFileProgress","onFileError"])],2)}var ve=K(se,[["render",de]]);export{ve as default};
