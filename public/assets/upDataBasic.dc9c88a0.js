var p=(i,w,o)=>new Promise((u,a)=>{var O=c=>{try{j(o.next(c))}catch(y){a(y)}},T=c=>{try{j(o.throw(c))}catch(y){a(y)}},j=c=>c.done?u(c.value):Promise.resolve(c.value).then(O,T);j((o=o.apply(i,w)).next())});import{b as q,u as $,dd as ee,av as Me,r as N,ay as ge,q as Ie,i as M,B as se,ab as le,cv as oe,cl as E,x as te,cW as ie,d8 as ae,bQ as De,c7 as Ne,bO as ce,c9 as ue,aG as h,G as ne}from"./index.10ef4608.js";/* empty css               *//* empty css                *//* empty css                */import{S as je}from"./spark-md5.2cc5764b.js";import{b as re,u as ye,a as ze,c as we}from"./updata.d7bd895d.js";import{u as de}from"./useSetFrom.689ec4a2.js";function Te(i,w,o={}){const u=new FileReader,a=new Date().getTime(),O=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,T=Math.ceil(i.size/w);let j=0;const c=new je.ArrayBuffer,y=()=>{let t=j*w,A=t+w>=i.size?i.size:t+w;u.readAsArrayBuffer(O.call(i,t,A))};y(),u.onload=t=>{if(c.append(t.target.result),j<T)j++,y(),o.onProgress&&typeof o.onProgress=="function"&&o.onProgress(j,T);else{let A=c.end();o.onSuccess&&typeof o.onSuccess=="function"&&o.onSuccess(A),console.log(`MD5\u8BA1\u7B97\u5B8C\u6BD5\uFF1A${i.name} 
MD5\uFF1A${A} 
\u5206\u7247\uFF1A${T} \u5927\u5C0F:${i.size} \u7528\u65F6\uFF1A${new Date().getTime()-a} ms`)}},u.onerror=function(){console.log("MD5\u8BA1\u7B97\u5931\u8D25"),o.onError&&typeof o.onError=="function"&&o.onError()}}function Ae(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!ce(i)}var be=q({name:"",props:{record:{type:Object,default:()=>{}}},emits:["upovered"],setup(i,{slots:w,emit:o}){const{t:u}=$(),a=ee(),{Dragger:O}=ue,{currents:T,indexs:j,record:c}=Me(i),y={name:"file",multiple:!0,onChange(e){const{status:g}=e.file;g!=="uploading"&&console.log(e.file,e.fileList)},customRequest:e=>p(this,null,function*(){R(e)}),onDrop(e){console.log("Dropped files",e.dataTransfer.files)},showUploadList:!1},t=N([]),{createMessage:A}=ne();N();const m=5*1024*1024,G=N(!1),Z=N(!0),f=N(!1),S=N({current:N(0),total:N(0)}),b=N(),k=N(0),U=N([{size:0,md5:"",name:""}]),F=N([]),Q=de(),W=N();ge(()=>t.value,(e,g)=>{Q.useFileList[1]=e},{deep:!0});const R=e=>p(this,null,function*(){f.value=!0;const g=e.file,D=g.size,n=Math.ceil(D/m);console.log("\u6587\u4EF6\u5927\u5C0F\uFF1A",g.size/1024/1024+"Mb","\u5206\u7247\u6570\uFF1A",n),S.value.total=n,console.log(g.name);let I,r=!0;U.value.forEach(s=>p(this,null,function*(){s.size==D&&s.name==g.name&&s.md5!=""&&(I=s.md5,r=!1)}));const z=t.value.length;if(r&&(I=yield J(g,m,z)),console.log("\u6587\u4EF6md5\uFF1A",I),console.log("\u5411\u540E\u7AEF\u8BF7\u6C42\u672C\u6B21\u5206\u7247\u4E0A\u4F20\u521D\u59CB\u5316"),I!==c.value.fileMd5){console.log(" \u6587\u4EF6\u4E0D\u540C"),A.error("\u6587\u4EF6\u4E0D\u540C"),t.value=[];return}const L=JSON.stringify({chunkCount:n,fileName:g.name,fileMd5:I,fileSize:D});U.value.push({size:D,md5:I,name:g.name}),f.value=!1;const V=yield re(L);yield(s=>p(this,null,function*(){const d=s.logId;W.value=d,o("upovered"),Q.SetUseUpBigData(d),F.value.push(d);const Y=[...new Set([...a.get("bigFileId")])];if(Y.push(d),a.set("bigFileId",Y),console.log("\u5BF9\u8BDD\u5B58\u50A8\u91CC\u9762\u7684\u6570\u636E",a.get("bigFileId")),typeof s=="string"&&(s=JSON.parse(s)),s.code===1){console.log("\u5F53\u524D\u6587\u4EF6\u4E0A\u4F20\u60C5\u51B5\uFF1A\u6240\u6709\u5206\u7247\u5DF2\u5728\u4E4B\u524D\u4E0A\u4F20\u5B8C\u6210\uFF0C\u4EC5\u9700\u5408\u5E76"),console.log(s.uploadId),v(d,n,I);const l=[...new Set([...a.get("bigFileId")])];l.forEach((C,x)=>{C==s.logId&&l.splice(x,1)}),a.set("bigFileId",l),console.log(" \u6211\u662F\u53EA\u9700\u8981\u5408\u5E76",l,s);return}if(s.code===0){console.log("\u5F53\u524D\u6587\u4EF6\u4E0A\u4F20\u60C5\u51B5\uFF1A\u79D2\u4F20"),console.log(s.url);const l=[...new Set([...a.get("bigFileId")])];l.forEach((C,x)=>{C==s.logId&&l.splice(x,1)}),a.set("bigFileId",l),console.log(" \u6211\u662F\u79D2\u4F20",l,s.logId),B();return}console.log("\u5F53\u524D\u6587\u4EF6\u4E0A\u4F20\u60C5\u51B5\uFF1A\u521D\u6B21\u4E0A\u4F20 \u6216 \u65AD\u70B9\u7EED\u4F20");const H=s.chunks;for(const l of H){const C=(l.partNumber-1)*m,x=Math.min(D,C+m),X=g.slice(C,x);console.log("\u5F00\u59CB\u4E0A\u4F20\u7B2C"+l.partNumber+"\u4E2A\u5206\u7247"),yield ye(l.uploadUrl,X),console.log("\u7B2C"+l.partNumber+"\u4E2A\u5206\u7247\u4E0A\u4F20\u5B8C\u6210");const _=JSON.stringify({logId:d,fileMd5:I,partNumber:l.partNumber,chunkCount:n}),{success:K}=yield ze(_);if(K)S.value.current=l.partNumber,console.log("\u7B2C"+l.partNumber+"\u4E2A\u5206\u7247\u4E0A\u4F20\u5E76\u8BB0\u5F55\u5B8C\u6210");else break}v(d,n,I)}))(V)}),v=(e,g,D)=>p(this,null,function*(){console.log("\u5F00\u59CB\u8BF7\u6C42\u540E\u7AEF\u5408\u5E76\u6587\u4EF6");const n=JSON.stringify({logId:e,ifBackend:!1,chunkCount:g,fileMd5:D});let I=yield we(n);if(typeof I=="string"&&(I=JSON.parse(I)),I.success){console.log("\u5408\u5E76\u6587\u4EF6\u5B8C\u6210",I);const r=[...new Set([...a.get("bigFileId")])];r.forEach((z,L)=>{z==I.logId&&r.splice(L,1)}),a.set("bigFileId",r),console.log("\u6211\u662F\u6700\u7EC8\u7684\u5408\u5E76\u6587\u4EF6 ",r,I),B()}else console.log("\u5408\u5E76\u6587\u4EF6\u5931\u8D25\uFF01")}),B=()=>{f.value=!1,G.value=!1,Z.value=!0,setTimeout(()=>{S.value.total=0,S.value.current=0},1e3),b.value="",k.value=0,U.value=[]};function J(e,g,D){const n={name:e.name,type:e.type,uid:e.uid,md5ProgressText:0,md5Progress:0};return t.value[D]=n,h(()=>{}),new Promise((I,r)=>{Te(e,g,{onProgress(z,L){h(()=>{b.value="\u6821\u9A8C\u6587\u4EF6\u5B89\u5168"+(z/L*100).toFixed(0)+"%",k.value=Number((z/L*100).toFixed(0)),t.value[D].md5ProgressText=b.value,t.value[D].md5Progress=k.value})},onSuccess(z){I(z)},onError(){console.log(`\u6587\u4EF6${e.name}\u8BFB\u53D6\u51FA\u9519\uFF0C\u8BF7\u68C0\u67E5\u8BE5\u6587\u4EF6`),r()}})})}const P=e=>{t.value.splice(e,1),Q.DelUseUpBigData(e)};return Ie(()=>{}),()=>{let e;return M("div",null,[" ",M("div",null,[M(O,se(y,{style:{width:"100%",minWidth:"450px"},fileList:t.value}),{default:()=>[M("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},[M("div",{style:{background:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzM3B4IiB2aWV3Qm94PSIwIDAgMzIgMzMiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU5ICg4NjEyNykgLSBodHRwczovL3NrZXRjaC5jb20gLS0+CiAgICA8dGl0bGU+aWNvbi3kuIrkvKA8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0i5aSa57uE5a2mVUkiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLlj6/op4bljJbliIbmnpAt5YGa5Zu+5q2l6aqk5LiA77yI5LiK5Lyg5by55qGG77yJIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtOTQ0LjAwMDAwMCwgLTQ4Ni4wMDAwMDApIiBmaWxsPSIjQzZDN0NEIiBmaWxsLXJ1bGU9Im5vbnplcm8iPgogICAgICAgICAgICA8ZyBpZD0i57yW57uELTMxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3MjMuMDAwMDAwLCA0MDUuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjI1LDg3LjE4NjgxMzIgTDIyNy44NDA5MDksODQuMTg2ODEzMiBMMjQ3LjE1OTA5MSw4NC4xODY4MTMyIEwyNTAsODcuMTg2ODEzMiBMMjI1LDg3LjE4NjgxMzIgWiBNMjQyLjEsMTAyLjYxNjMyMyBMMjQyLjEsMTA3LjE4NjgxMyBMMjMyLjksMTA3LjE4NjgxMyBMMjMyLjksMTAyLjYxNjMyMyBMMjI2LDEwMi42MTYzMjMgTDIzNi43MDk5NSw5MS41MjYwMjk0IEMyMzcuMTQ1OCw5MS4wNzM1NTA5IDIzNy44NTY1LDkxLjA3NDY5MzUgMjM4LjI5MDA1LDkxLjUyMzc0NDEgTDI0OSwxMDIuNjE2MzIzIEwyNDIuMSwxMDIuNjE2MzIzIFogTTI1Mi4zNjQ1NzEsODcuMDkwODEzMiBMMjQ5LjA2NCw4Mi4xMzk5NTYgQzI0OC43MTQyODYsODEuNjE1Mzg0NiAyNDcuOTIxMTQzLDgxLjE4NjgxMzIgMjQ3LjI5NDg1Nyw4MS4xODY4MTMyIEwyMjYuNzA1MTQzLDgxLjE4NjgxMzIgQzIyNi4wOTE0MjksODEuMTg2ODEzMiAyMjUuMjg2ODU3LDgxLjYxNDI0MTggMjI0LjkzNiw4Mi4xMzk5NTYgTDIyMS42MzU0MjksODcuMDkwODEzMiBDMjIxLjI4NTcxNCw4Ny42MTUzODQ2IDIyMSw4OC41NTcwOTg5IDIyMSw4OS4xODkwOTg5IEwyMjEsMTEwLjkxMTM4NSBDMjIxLDExMi4xNjk2NyAyMjIuMDE5NDI5LDExMy4xODY4MTMgMjIzLjI3NTQyOSwxMTMuMTg2ODEzIEwyNTAuNzI0NTcxLDExMy4xODY4MTMgQzI1MS45NzE0MjksMTEzLjE4NjgxMyAyNTMsMTEyLjE2ODUyNyAyNTMsMTEwLjkxMTM4NSBMMjUzLDg5LjE4OTA5ODkgQzI1Myw4OC41NDU2NzAzIDI1Mi43MTU0MjksODcuNjE2NTI3NSAyNTIuMzY0NTcxLDg3LjA5MDgxMzIiIGlkPSJpY29uLeS4iuS8oCI+PC9wYXRoPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=)",height:"32px",width:"32px"}},null)]),M("p",{class:"ant-upload-hint",style:{margin:"20px 0px"}},[u("rdm.dataChange.dragFileHere")]),M(le,{style:{background:"#3152ed",color:"#ffffff",border:"1px solid #666666",margin:"0px 0px",borderRadius:"4px"}},Ae(e=u("rdm.dataChange.selectFile"))?e:{default:()=>[e]})]}),M("div",{style:{height:"300px",overflow:"auto"}},[" ",t.value.map((g,D)=>M("div",{key:g.name,style:{display:"flex",justifyContent:"center",width:"100%",height:"60px",fontSize:"12px",textAlign:"left"}},[M("div",{style:{width:"20%",height:"60px",display:"flex",justifyContent:"center",alignItems:"center"}},[M("div",{style:{width:"20px",height:"20px",background:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjlweCIgaGVpZ2h0PSIzMHB4IiB2aWV3Qm94PSIwIDAgMjkgMzAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8dGl0bGU+aWNvbi3mlofku7Y8L3RpdGxlPgogICAgPGcgaWQ9IuWfuuehgOaVsOaNruW6kyIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IuWfuuWboOewh+W6k++8muaVsOaNruWIl+ihqCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTk0Ni4wMDAwMDAsIC01NDMuMDAwMDAwKSIgZmlsbC1ydWxlPSJub256ZXJvIj4KICAgICAgICAgICAgPGcgaWQ9Imljb24t5paH5Lu2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5NDYuMDAwMDAwLCA1NDMuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjUuOTg0OTA4MSwyNi42NjQ5NzMzIEMyNS45ODQ5MDgxLDI3LjAzMzI3NDEgMjUuODMzOTg5NSwyNy4zODY4NDI4IDI1LjU2MjMzNiwyNy42NTIwMTkzIEMyNS4yOTA2ODI0LDI3LjkxNzE5NTggMjQuOTI4NDc3NywyOC4wNjQ1MTYxIDI0LjU1MTE4MTEsMjguMDY0NTE2MSBMNC40MzM3MjcwMywyOC4wNjQ1MTYxIEM0LjA1NjQzMDQ1LDI4LjA2NDUxNjEgMy42NzkxMzM4NiwyNy45MTcxOTU4IDMuNDIyNTcyMTgsMjcuNjUyMDE5MyBDMy4xNTA5MTg2NCwyNy4zODY4NDI4IDMsMjcuMDMzMjc0MSAzLDI2LjY2NDk3MzMgTDMsMS4zOTk1NDI4IEMzLDEuMDMxMjQyMDYgMy4xNTA5MTg2NCwwLjY2Mjk0MTMyNiAzLjQyMjU3MjE4LDAuNDEyNDk2ODI1IEMzLjY3OTEzMzg2LDAuMTQ3MzIwMjk1IDQuMDU2NDMwNDUsMCA0LjQzMzcyNzAzLDAgTDE2Ljc3ODg3MTQsMCBDMTcuMTU2MTY4LDAgMTcuNTMzNDY0NiwwLjE0NzMyMDI5NSAxNy44MDUxMTgxLDAuNDEyNDk2ODI1IEwyNS41Nzc0Mjc4LDcuOTk5NDkyIEMyNS44NDkwODE0LDguMjY0NjY4NTMgMjYsOC42MTgyMzcyNCAyNiw5LjAwMTI3IEwyNiwyNi42NjQ5NzMzIEwyNS45ODQ5MDgxLDI2LjY2NDk3MzMgWiIgaWQ9Iui3r+W+hCIgZmlsbD0iI0VCRUNGMCI+PC9wYXRoPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTI2LDI3LjA5Njc3NDIgTDI2LDI4LjU0ODM4NzEgQzI2LDI4LjkzMDM5MDUgMjUuODQ4OTgyMywyOS4zMTIzOTM5IDI1LjU3NzE1MDQsMjkuNTcyMTU2MiBDMjUuMzA1MzE4NSwyOS44NDcxOTg2IDI0Ljk0Mjg3NTksMzAgMjQuNTY1MzMxNiwzMCBMNC40MzQ2Njg0MiwzMCBDMy42MzQyNzQ0NiwzMCAzLDI5LjM0Mjk1NDIgMywyOC41NDgzODcxIEwzLDI3LjA5Njc3NDIgQzMsMjcuNDc4Nzc3NiAzLjE1MTAxNzczLDI3Ljg0NTUwMDggMy40MjI4NDk2NCwyOC4xMjA1NDMzIEMzLjY5NDY4MTU1LDI4LjM5NTU4NTcgNC4wNTcxMjQxLDI4LjU0ODM4NzEgNC40MzQ2Njg0MiwyOC41NDgzODcxIEwyNC41NjUzMzE2LDI4LjU0ODM4NzEgQzI1LjM2NTcyNTUsMjguNTQ4Mzg3MSAyNiwyNy44OTEzNDEzIDI2LDI3LjA5Njc3NDIgWiIgaWQ9Iui3r+W+hCIgZmlsbD0iI0MxQzdEMCI+PC9wYXRoPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTAsMTUuNDgzODcxIEwyOSwxNS40ODM4NzEgTDI5LDIyLjc0NDQ3NzcgQzI5LDIzLjU1MjkwNjYgMjguMzQ1NDA2OCwyNC4xOTM1NDg0IDI3LjU1MzgwNTgsMjQuMTkzNTQ4NCBMMS40NjE0MTczMiwyNC4xOTM1NDg0IEMxLjA4MDgzOTksMjQuMTkzNTQ4NCAwLjcwMDI2MjQ2NywyNC4wNDEwMTQ2IDAuNDQxNDY5ODE2LDIzLjc2NjQ1MzkgQzAuMTY3NDU0MDY4LDIzLjQ5MTg5MzEgMC4wMTUyMjMwOTcxLDIzLjEyNTgxMjEgMC4wMTUyMjMwOTcxLDIyLjcyOTIyNDMgTDAuMDE1MjIzMDk3MSwxNS40ODM4NzEgTDAsMTUuNDgzODcxIFoiIGlkPSLot6/lvoQiIGZpbGw9IiM0N0IzNDciPjwvcGF0aD4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0yLjkwNjA4NjA0LDE1LjQ4Mzg3MSBMMi45MDYwODYwNCwxMi41ODA2NDUyIEwwLDE1LjQ4Mzg3MSBMMi45MDYwODYwNCwxNS40ODM4NzEgWiBNMjYuMDc4Njk4OCwxNS40ODM4NzEgTDI2LjEwOTEyOTEsMTIuNTgwNjQ1MiBMMjksMTUuNDgzODcxIEwyNi4wNzg2OTg4LDE1LjQ4Mzg3MSBaIiBpZD0i5b2i54q2IiBmaWxsPSIjMkE5MzJBIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjUuOTk4ODc2Miw5LjQ3NTgwNjQ1IEwyNS45OTg4NzYyLDkuNjc3NDE5MzUgTDE3LjU1NzIwMiw5LjY3NzQxOTM1IEMxNi42ODg0NDcyLDkuNjc3NDE5MzUgMTYsOS4wMTA1NDU5MSAxNiw4LjIwNDA5NDI5IEwxNiwwIEMxNi40MDk3OSwwIDE2LjgxOTU4LDAuMTU1MDg2ODQ5IDE3LjExNDYyODgsMC40MzQyNDMxNzYgTDI1LjU3MjY5NDUsOC40MjEyMTU4OCBDMjUuODUxMzUxOCw4LjcwMDM3MjIxIDI2LjAxNTI2NzgsOS4wNzI1ODA2NSAyNS45OTg4NzYyLDkuNDc1ODA2NDUgTDI1Ljk5ODg3NjIsOS40NzU4MDY0NSBaIiBpZD0i6Lev5b6EIiBmaWxsPSIjQzFDN0QwIj48L3BhdGg+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==)"}},null)]),M("div",{style:{width:"80%",height:"60px"}},[M(oe,null,{default:()=>[M(E,{span:11,style:{textOverflow:"ellipsis",width:"100%"}},{default:()=>[M(te("a-typography-text"),{style:{width:"100%"},ellipsis:!0,content:g.name},null)]}),g.md5Progress==100?M(E,{span:10,offset:1},{default:()=>[" ",u("rdm.dataChange.verifyThatFileSecure"),M(ie,null,null)]}):M(E,{span:10,offset:1},{default:()=>[" ",u("rdm.dataChange.verifyFileSecurity")]}),g.md5Progress==100?M(E,{span:2},{default:()=>[M(ae,{onClick:()=>{P(D)}},null)]}):M(E,{span:2},{default:()=>[M(De,{onClick:()=>{P(D)}},null)]})]}),M(Ne,{percent:g.md5Progress,strokeColor:g.md5Progress==100?"#93d3bb":"#e19f32"},null)])]))]),M("div",null,null)])])}}});export{be as default};
