var S=(h,o,l)=>new Promise((d,y)=>{var t=i=>{try{r(l.next(i))}catch(n){y(n)}},c=i=>{try{r(l.throw(i))}catch(n){y(n)}},r=i=>i.done?d(i.value):Promise.resolve(i.value).then(t,c);r((l=l.apply(h,o)).next())});import{r as b,aT as q,a as K,b as U,u as L,ay as D,q as z,x as O,o as N,c as A,i as _,A as T,e as m,t as x,j as E,af as X,I as G,d5 as H,y as J,z as P,D as V,ao as Q,ap as W}from"./index.10ef4608.js";import{u as Y}from"./casual.c3003c80.js";import{d as j}from"./util.4fd96932.js";import"./index.89ad81d5.js";import{a as Z}from"./Export2Excel.92374bf3.js";const de=(h,o,l,d,y)=>(()=>{var w;const t=JSON.parse(JSON.stringify(h)),c=[...t].pop();t.length=(t==null?void 0:t.length)-1;const r=[];t==null||t.forEach((g,v)=>{r.push([]),r[v]=g[0]}),t==null||t.forEach(g=>{g.splice(0,1)});let i=0;t==null||t.forEach(g=>{g.length>i&&(i=g.length)}),t==null||t.forEach((g,v)=>{for(let p=0;p<i;p++)t[v][p]||(t[v][p]=[])}),t==null||t.forEach((g,v)=>{t[v].forEach((p,k)=>{var s;if(p.length<r[v].length)for(let e=p.length;e<((s=r[v])==null?void 0:s.length);e++)p.push("")})}),t==null||t.forEach((g,v)=>{t[v].forEach((p,k)=>{p.length>r[v].length&&(p.length=r[v].length)})});const n=[];(w=t[0])==null||w.forEach((g,v)=>{n[v]=[]}),t==null||t.forEach((g,v)=>{g.forEach((p,k)=>{p.length&&p.forEach(s=>{n[k].push(s)})})});const u=[];return n.forEach((g,v)=>{const p={};g.length&&g.forEach((k,s)=>{p[`${c[0][s]}`]=k,p.key=v}),u.push(p)}),o.value=u,l.setuseVisualConstructionTwobody(u),d.value=u,y.value=u,u})(),pe=(h,o,l,d,y,t,c,r,i,n)=>{n.value=[];const u=[...JSON.parse(JSON.stringify(h))],w=[...JSON.parse(JSON.stringify(o.value))];w.forEach(s=>{delete s.key});const g=[],v=[...u].pop();u.length=u.length-1,u==null||u.forEach(s=>{s[0].forEach(e=>{g.push(e)})});const p=[],k=[];for(let s=0;s<w.length;s++){let e=0;if(k.forEach(a=>{typeof a=="boolean"&&(e=e+1)}),Object.keys(w[s]).forEach((a,f)=>{const F=w[s][a];F!=""&&(k[f]=isNaN(F))}),e==g.length)break}return g.forEach(()=>n.value.push("")),g.forEach((s,e)=>{p.push(k[e]?{title:`${s}`,dataIndex:v[0][e],width:400,filterMultiple:!0,slots:{filterDropdown:"filterDropdown",filterIcon:"filterIcon",customRender:"customRender",height:"10px"},helpMessage:`\u7B2C${e+1}\u5217`,sorter:(a,f,F)=>{B(v[0][e],F,k[e],r,i)},sortOrder:n.value[e],type:"string",index:e}:{title:`${s}`,dataIndex:v[0][e],width:400,helpMessage:`\u7B2C${e+1}\u5217`,sorter:(a,f,F)=>{B(v[0][e],F,k[e],r,i)},filterMultiple:!0,slots:{filterDropdown:"filterDropNumber",filterIcon:"filterIcon",customRender:"customRender",height:"10px"},sortOrder:n.value[e],type:"number",index:e})}),d.setuseVisualConstructionTwohander(p),y.value=JSON.parse(JSON.stringify(p)),t.value=j(p),c.value=v[0],p},B=q((h,o,l,d,y)=>{const t=d();l?(t.sort((c,r)=>{var i,n,u,w;return o=="ascend"?((i=c[h].charAt(0))==null?void 0:i.charCodeAt())-((n=r[h].charAt(0))==null?void 0:n.charCodeAt()):((u=r[h].charAt(0))==null?void 0:u.charCodeAt())-((w=c[h].charAt(0))==null?void 0:w.charCodeAt())}),y(t)):(t.sort((c,r)=>o=="ascend"?c[h]-r[h]:r[h]-c[h]),y(t))},100),M=b(),ve=(n,u,w,g,v,p,k,s)=>S(void 0,[n,u,w,g,v,p,k,s],function*(h,o,{column:l,order:d},y,t,c,r,i){if(console.log(" ",12314),d=="ascend"){const e=yield c();e.slice(1).forEach((a,f)=>{l.dataIndex==a.dataIndex?function(){a.sortOrder="ascend",t[f]="ascend"}():function(){a.sortOrder=!1,t[f]=!1}()}),r(e)}else if(d=="descend"){const e=yield c();e.slice(1).forEach((a,f)=>{l.dataIndex==a.dataIndex?function(){a.sortOrder="descend",t[f]="descend"}():function(){a.sortOrder=!1,t[f]=!1}()}),r(e)}else if(!d&&JSON.stringify(M.value)==JSON.stringify(i)){const e=yield c();e.slice(1).forEach((a,f)=>{f==ee(t)?function(){a.sortOrder="ascend"}():function(){a.sortOrder=!1}()}),r(e)}M.value=i});function ee(h){for(let o=0;o<h.length;o++)if(typeof h[o]=="string")return o;return-1}const ye=(h,o,l,d,y,t)=>S(void 0,null,function*(){return h(R(yield o(),yield l(),"key")),t.setuseVisualConstructionTwobody([...JSON.parse(JSON.stringify(R(yield o(),yield l(),"key")))]),d(),!0}),R=(h,o,l)=>h.filter(d=>!o.some(t=>t[l]===d[l])),ge=(h,o)=>S(void 0,null,function*(){const l=yield h(),d=yield o(),y=d.slice(1).map(c=>c.title),t=l.map(c=>d.slice(1).map(r=>r.slots?c[r.dataIndex]:Number(c[r.dataIndex])||0));Z({data:t,header:y,filename:"\u5BFC\u51FA\u6570\u636E.xlsx"})});const te={style:{position:"relative",top:"10px"}},ae={style:{width:"386px",height:"250px"}},oe={style:{padding:"10px"}},le={style:{padding:"10px",height:"195px",overflow:"auto"}},se=U({__name:"ColFilter",props:{getColumns:{type:Function,required:!0},setColumns:{type:Function,required:!0},setTableData:{type:Function,required:!0},refresh:{type:Function,required:!0},isShowColFilterFn:{type:Function,required:!0},setProps:{type:Function,required:!0},clearSelectedRowKeys:{type:Function,required:!0}},setup(h){const o=h,l=Y(),d=b(!1),y=b(""),{t}=L(),c=b(!0),r=b(!0),i=b(!1),n=b([]),u=b([]),w=b([]),g=q((s,e)=>{d.value=!0,setTimeout(()=>{d.value=!1},300),y.value?(u.value.filter(a=>s.title===a.title)[0].key=s.key,o.setColumns([...u.value.filter(a=>a.key===!0)]),u.value.some(a=>a.key===!0)||(o.setTableData([]),l.useVisualConstructionTwobody=[],o.setProps({rowSelection:{type:"checkbox",columnTitle:" "}}),o.clearSelectedRowKeys(),o.isShowColFilterFn(!0))):(u.value[e].key=s.key,o.setColumns([...u.value.filter(a=>a.key===!0)]),u.value.some(a=>a.key===!0)||(o.setTableData([]),l.useVisualConstructionTwobody=[],o.setProps({rowSelection:{type:"checkbox",columnTitle:" "}}),o.clearSelectedRowKeys(),o.isShowColFilterFn(!0)),u.value.every(a=>a.key===!0)?c.value=!0:c.value=!1),s.key&&(o.setTableData([...w.value]),l.useVisualConstructionTwobody=[...w.value],o.isShowColFilterFn(!1),o.setProps({rowSelection:{type:"checkbox",columnTitle:""}})),y.value?k(n.value):setTimeout(()=>{k(u.value)},100),l.useVisualConstructionTwohander=[...u.value.filter(a=>a.key===!0)]},100),v=s=>{d.value=!0,setTimeout(()=>{d.value=!1},1e3),s?y.value||o.refresh():(o.setTableData([]),l.useVisualConstructionTwobody=[],o.setProps({rowSelection:{type:"checkbox",columnTitle:" "}}),o.clearSelectedRowKeys(),o.isShowColFilterFn(!0)),n.value.forEach(e=>e.key=s),n.value.forEach((e,a)=>{g(e,a)}),s&&y.value&&(o.setTableData([...w.value]),l.useVisualConstructionTwobody=[...w.value])},p=s=>{d.value=!0,setTimeout(()=>{d.value=!1},1e3),console.log(" ",n.value,u.value),n.value.forEach(e=>e.key=s),n.value.forEach((e,a)=>g(e,a))},k=s=>{const e=j(s);let a=!0,f=!0;for(const F of e)F.key!==!0&&(a=!1),F.key!==!1&&(f=!1);a?(console.log("\u6240\u6709\u5BF9\u8C61\u7684key\u5C5E\u6027\u90FD\u662Ftrue"),i.value=!1):f?(console.log("\u6240\u6709\u5BF9\u8C61\u7684key\u5C5E\u6027\u90FD\u662Ffalse"),i.value=!1):(console.log("\u5BF9\u8C61\u7684key\u5C5E\u6027\u65E2\u4E0D\u5168\u662Ftrue\u4E5F\u4E0D\u5168\u662Ffalse"),i.value=!0)};return D(()=>l.useVisualOneToTwo,()=>{l.useVisualConstructionTwohander=[];const s=setInterval(()=>{var e,a;l.useVisualConstructionTwohander.length>0&&(w.value=[...l.useVisualConstructionTwobody],n.value=l.useVisualConstructionTwohander,u.value=l.useVisualConstructionTwohander,(e=n.value)==null||e.forEach(f=>f.key=!0),(a=u.value)==null||a.forEach(f=>f.key=!0),o.isShowColFilterFn(!1),o.setProps({rowSelection:{type:"checkbox",columnTitle:""}}),clearInterval(s))},1e3)},{deep:!0}),D(()=>l.FilterToCol,()=>{R(n.value,l.FilterToCol,"dataIndex").forEach(e=>{n.value.forEach(a=>{e.dataIndex==a.dataIndex&&(a.key=!1)})}),c.value=!1,i.value=!0,l.FilterToCol.length==0&&(c.value=!1,i.value=!1)}),D(()=>l.informData,()=>{const s=setInterval(()=>{var e,a;l.useVisualConstructionTwohander.length>0&&(w.value=[...l.useVisualConstructionTwobody],n.value=[...l.useVisualConstructionTwohander],u.value=[...l.useVisualConstructionTwohander],(e=n.value)==null||e.forEach(f=>f.key=!0),(a=u.value)==null||a.forEach(f=>f.key=!0),o.isShowColFilterFn(!1),o.setProps({rowSelection:{type:"checkbox",columnTitle:""}}),c.value=!0,i.value=!1,clearInterval(s))},1e3)}),z(()=>S(this,null,function*(){const s=setInterval(()=>{var e,a;l.useVisualConstructionTwohander.length>0&&(w.value=[...l.useVisualConstructionTwobody],n.value=[...l.useVisualConstructionTwohander],u.value=[...l.useVisualConstructionTwohander],(e=n.value)==null||e.forEach(f=>f.key=!0),(a=u.value)==null||a.forEach(f=>f.key=!0),o.isShowColFilterFn(!1),o.setProps({rowSelection:{type:"checkbox",columnTitle:""}}),clearInterval(s))},1e3)})),(s,e)=>{const a=O("a-checkbox"),f=O("a-button"),F=O("a-popover");return N(),A("div",null,[_(F,{trigger:"click",placement:"bottomLeft",getPopupContainer:C=>C.parentElement,onVisibleChange:e[7]||(e[7]=()=>{y.value="",n.value=u.value})},{title:T(()=>[m("div",te,x(E(t)("visual.construction.setting")),1)]),content:T(()=>[_(E(X),{spinning:d.value},{default:T(()=>[m("div",ae,[m("div",oe,[_(E(G),{value:y.value,"onUpdate:value":e[0]||(e[0]=C=>y.value=C),allowClear:"",onChange:e[1]||(e[1]=({data:C})=>{C?function(){n.value=n.value.filter(I=>I.title.indexOf(C)!==-1),k(n.value)}():function(){n.value=u.value,k(u.value)}()}),style:{width:"290px"},placeholder:E(t)("AllMessage.visual.two.ExcelDisplay.ColFilter.placeholder")},{prefix:T(()=>[_(E(H))]),_:1},8,["value","placeholder"])]),m("div",le,[J(m("div",null,[_(a,{checked:c.value,"onUpdate:checked":e[2]||(e[2]=C=>c.value=C),onChange:e[3]||(e[3]=C=>{v(C.target.checked)}),indeterminate:i.value},{default:T(()=>[V(x(E(t)("AllMessage.visual.two.ExcelDisplay.ColFilter.all")),1)]),_:1},8,["checked","indeterminate"])],512),[[P,y.value==""]]),J(m("div",null,[_(a,{checked:r.value,"onUpdate:checked":e[4]||(e[4]=C=>r.value=C),onChange:e[5]||(e[5]=C=>{p(C.target.checked)}),indeterminate:i.value},{default:T(()=>[V(x(E(t)("AllMessage.visual.two.ExcelDisplay.ColFilter.all")),1)]),_:1},8,["checked","indeterminate"])],512),[[P,y.value!=""]]),(N(!0),A(Q,null,W(n.value,(C,I)=>J((N(),A("div",{key:C},[_(a,{checked:C.key,"onUpdate:checked":$=>C.key=$,onChange:()=>{E(g)(C,I)}},{default:T(()=>[V(x(C.title),1)]),_:2},1032,["checked","onUpdate:checked","onChange"])])),[[P,C.title!=="\u5E8F\u53F7"]])),128))])])]),_:1},8,["spinning"])]),default:T(()=>[_(f,{type:"link",onClick:e[6]||(e[6]=()=>{})},{default:T(()=>[V(x(E(t)("visual.construction.setting")),1)]),_:1})]),_:1},8,["getPopupContainer"])])}}});var ne=K(se,[["__scopeId","data-v-2106b2a6"]]),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{ne as C,ye as R,ge as a,Ce as b,de as d,pe as g,ve as s};
