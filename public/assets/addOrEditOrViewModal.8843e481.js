var m=(_,p,e)=>new Promise((c,r)=>{var w=l=>{try{f(e.next(l))}catch(g){r(g)}},u=l=>{try{f(e.throw(l))}catch(g){r(g)}},f=l=>l.done?c(l.value):Promise.resolve(l.value).then(w,u);f((e=e.apply(_,p)).next())});import{b as O,B as R}from"./index.c8f8ec06.js";import{u as j,B as T}from"./useForm.98d7b8ca.js";import{a as U,b as G,u as L,r as S,l as $,j as t,aT as A,x as z,o as E,U as x,A as h,e as V,i as P,D as k,t as q,f as H,X as J,B as K,G as Q}from"./index.10ef4608.js";import{c as M,b as Y,E as Z}from"./platfrom.439ed019.js";import"./useAttrs.1d381a3e.js";import"./useWindowSizeFn.3e5b045d.js";import"./useModalContext.52c86736.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               */import"./index.b6ac86eb.js";/* empty css                *//* empty css                */import"./uuid.2429c801.js";import"./TableAction.edf9a202.js";/* empty css                */import"./download.66a6d137.js";import"./index.504b494d.js";const ee={style:{position:"relative",top:"50px"}},te={class:"flex justify-end"},ae=G({__name:"addOrEditOrViewModal",props:{success:{type:Function,required:!0},leiXingCode:{type:Array,required:!0}},setup(_){const p=_,{t:e}=L(),{createMessage:c}=Q(),r=S("add"),w=$(()=>t(r)==="add"?e("AllMessage.cmAdd"):t(r)==="edit"?e("AllMessage.cmEdit"):e("AllMessage.cmView")),u=S(),[f,{closeModal:l}]=O(n=>m(this,[n],function*({statusText:i,record:o}){C(),r.value=i,u.value=o,i=="edit"?setTimeout(()=>{new Promise(a=>{B([{field:"leiXingCode",component:"Select",labelWidth:80,label:e("cm.platform.type"),slot:"leiXingCode",colProps:{span:24}},{field:"name",labelWidth:80,component:"Input",label:e("cm.platform.platformName"),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E"}],componentProps:({formActionType:s})=>({onBlur:A(()=>m(this,null,function*(){try{const{updateSchema:d,validate:v}=s,b={name:u.value.name,type:1,codes:u.value.leiXingCode,id:u.value.id};if(!b.name||!b.codes)return;const y=yield M(b);yield d({field:"name",rules:[{validator:()=>y?Promise.resolve():Promise.reject("\u5DF2\u5B58\u5728"),required:!0}]}),yield v(["name"])}catch(d){console.error(d)}}),100)}),colProps:{span:24}}]),a("edit")}).then(()=>{const a=[];o.types.forEach((s,d)=>{a.push(s.code)}),X({name:o.name,leiXingCode:a}),F({disabled:!1})})},300):i=="view"?setTimeout(()=>{new Promise(a=>{B([{field:"leiXingCode",component:"Select",labelWidth:80,label:e("cm.platform.type"),slot:"leiXingCode",colProps:{span:24}},{field:"name",labelWidth:80,component:"Input",label:e("cm.platform.platformName"),rules:[],colProps:{span:24}}]),a("view")}).then(()=>{const a=[];o.types.forEach((s,d)=>{a.push(s.code)}),X({name:o.name,leiXingCode:a}),F({disabled:!0})})},300):i=="add"&&setTimeout(()=>{new Promise(a=>{B([{field:"leiXingCode",component:"Select",labelWidth:80,label:e("cm.platform.type"),slot:"leiXingCode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7C7B\u578B",type:"array"}],colProps:{span:24}},{field:"name",labelWidth:80,component:"Input",label:e("cm.platform.platformName"),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E"}],componentProps:({formActionType:s,formModel:d})=>({onBlur:A(()=>m(this,null,function*(){try{const{updateSchema:v,validate:b}=s,y={name:d.name,type:1,codes:d.leiXingCode};if(!y.name||!y.codes)return;const W=yield M(y);yield v({field:"name",rules:[{validator:()=>W?Promise.resolve():Promise.reject("\u5DF2\u5B58\u5728"),required:!0}]}),yield b(["name"])}catch(v){console.error(v)}}),100)}),colProps:{span:24}}]),a("add")}).then(()=>{F({disabled:!1})})},300)})),[g,{resetFields:C,getFieldsValue:N,setFieldsValue:X,validate:D,updateSchema:B,setProps:F}]=j({showActionButtonGroup:!1,labelWidth:80,disabled:!1,schemas:[{field:"leiXingCode",component:"Select",label:e("cm.platform.type"),slot:"leiXingCode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7C7B\u578B",type:"array"}],colProps:{span:24}},{field:"name",component:"Input",label:e("cm.platform.platformName"),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E"},{validator:(i,o)=>m(this,null,function*(){return new Promise((n,a)=>{const s={name:o,type:1,codes:[]};!s.name||!s.codes||M(s).then(()=>{n()}).catch(()=>{a("\u5DF2\u5B58\u5728")})})}),validateTrigger:"blur"}],colProps:{span:24}}]}),I=()=>m(this,null,function*(){try{if(!(yield D()))return;const o=N();if(t(r)==="add"){const n=yield Y(o);n.code===200?c.success(e("AllMessage.successAdd")):c.error(n.msg),p.success()}else if(t(r)==="edit"){o.id=u.value.id;const n=yield Z(o);n.code===200?c.success(e("AllMessage.successEdit")):c.error(n.msg),p.success()}l(),C()}catch(i){console.error(i)}finally{}});return(i,o)=>{const n=z("CustomButton");return E(),x(t(R),K(i.$attrs,{onRegister:t(f),title:t(w)}),{footer:h(()=>[V("div",te,[P(n,{btnStyle:{backgroundColor:"#fff",border:"1px solid rgb(102, 102, 102)",padding:"0px 20px",color:"#000",marginLeft:"10px"},onClick:o[0]||(o[0]=()=>{t(C)(),r.value=="view"?function(){t(l)()}():function(){t(C)()}()})},{default:h(()=>[k(q(r.value=="view"?t(e)("AllMessage.cancel"):t(e)("AllMessage.reset")),1)]),_:1},8,["btnStyle"]),r.value!=="view"?(E(),x(n,{key:0,btnStyle:{backgroundColor:"#2F54EB",padding:"0px 20px",color:"#fff"},onClick:I},{default:h(()=>[k(q(t(e)("AllMessage.confirm")),1)]),_:1})):H("v-if",!0)])]),default:h(()=>[V("div",ee,[P(t(T),{onRegister:t(g),ref:"basicForm"},{leiXingCode:h(({model:a,field:s})=>[P(t(J),{ref:"select",value:a[s],"onUpdate:value":d=>a[s]=d,allowClear:"",mode:"multiple",options:p.leiXingCode,disabled:r.value=="view",placeholder:t(e)("AllMessage.pleaseEnter")},null,8,["value","onUpdate:value","options","disabled","placeholder"])]),_:1},8,["onRegister"])])]),_:1},16,["onRegister","title"])}}});var Me=U(ae,[["__scopeId","data-v-4b428edb"]]);export{Me as default};
