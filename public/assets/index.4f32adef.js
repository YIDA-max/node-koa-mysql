var Fe=Object.defineProperty,ye=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var O=(u,m,e)=>m in u?Fe(u,m,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[m]=e,G=(u,m)=>{for(var e in m||(m={}))_e.call(m,e)&&O(u,e,m[e]);if(M)for(var e of M(m))Se.call(m,e)&&O(u,e,m[e]);return u},j=(u,m)=>ye(u,De(m));var g=(u,m,e)=>new Promise((a,A)=>{var w=c=>{try{R(e.next(c))}catch(D){A(D)}},v=c=>{try{R(e.throw(c))}catch(D){A(D)}},R=c=>c.done?a(c.value):Promise.resolve(c.value).then(w,v);R((e=e.apply(u,m)).next())});import{a as Ae,b as we,a5 as xe,u as ve,a6 as qe,r as y,ay as Ue,d7 as Ie,q as be,x as N,o as x,c as U,i,A as l,j as o,cM as I,e as f,D as S,t as F,X as Ee,cv as B,ao as V,ap as $,U as Pe,cl as b,am as Te,y as z,z as K,G as ke,p as Le,k as Ge}from"./index.10ef4608.js";import{u as Ne,B as Be}from"./useForm.98d7b8ca.js";import{P as Me}from"./index.8d0858e7.js";/* empty css                *//* empty css               *//* empty css               */import{u as Oe}from"./useSetFrom.689ec4a2.js";import{q as je,e as Ve}from"./homePage.5560d038.js";import $e from"./index.460a8063.js";import ze from"./upData.f3f08e91.js";import{u as J,B as W}from"./useTable.a143d40c.js";import"./TableAction.edf9a202.js";import{b as H}from"./homePage.249d27b4.js";import{d as Ke}from"./download.66a6d137.js";import{l as Je,g as We}from"./increasedData.fb1d93c6.js";import{S as He}from"./add.f693dce6.js";import{f as Xe}from"./fileSys.281186ac.js";import{L as Qe}from"./LinkOutlined.b4db2572.js";/* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               */import"./index.b6ac86eb.js";import"./useAttrs.1d381a3e.js";/* empty css                *//* empty css                */import"./uuid.2429c801.js";import"./index.c8f8ec06.js";import"./useWindowSizeFn.3e5b045d.js";import"./useModalContext.52c86736.js";/* empty css                */import"./index.504b494d.js";/* empty css               */import"./onMountedOrActivated.0d13b2a6.js";import"./useContentViewHeight.9302814f.js";import"./CustomConfirmModal.6e54a0af.js";import"./modal-error.7cada6d5.js";import"./upData.8c2d7db8.js";import"./spark-md5.2cc5764b.js";import"./updata.d7bd895d.js";import"./CustomConfirmModal.a792e716.js";import"./upDataBasic.dc9c88a0.js";import"./icon-remark.1929ee0a.js";import"./useSortable.79752a2a.js";/* empty css                */import"./aes.1609b06a.js";const E=u=>(Le("data-v-44c56609"),u=u(),Ge(),u),Ye={class:"operate_btns"},Ze=E(()=>f("div",{class:"w-0 h-4"},null,-1)),et=E(()=>f("div",{class:"w-0 h-4"},null,-1)),tt={class:"flex justify-center"},at={class:"progress-bar"},ot={class:"grid grid-flow-col justify-end"},nt=E(()=>f("br",null,null,-1)),st=E(()=>f("br",null,null,-1)),rt=we({__name:"index",setup(u){const m=xe(),{t:e}=ve(),a=Oe(),A=qe(),w=y([]),v=y([]),R=y({}),c=y([]),D=y({}),{createMessage:P}=ke(),T=y(!1);Ue(()=>a.useRdmFileList,()=>{v.value=a.useRdmFileList},{deep:!0});const k=y(!0),[X,{resetFields:Q,setFieldsValue:Y,validate:Z,getFieldsValue:ee}]=Ne({labelWidth:100,baseColProps:{span:10,offset:1},schemas:[{field:"species",component:"Input",label:e("rdm.dataChange.species"),rules:[{required:!0,validator:(n,t)=>g(this,null,function*(){return t?t.length>30?Promise.reject(e("AllMessage.RdmTextThree")):Promise.resolve():Promise.reject(e("AllMessage.RdmTextTwo"))}),trigger:"change"}]},{field:"speciesId",component:"Input",label:e("rdm.dataChange.speciesId"),rules:[{required:!0,validator:(n,t)=>g(this,null,function*(){return t?t.length>30?Promise.reject(e("AllMessage.RdmTextThree")):isNaN(t)?Promise.reject(e("AllMessage.RdmTextThreeNumber")):Promise.resolve():Promise.reject(e("AllMessage.RdmTextTwo"))}),trigger:"change"}]},{field:"genomeVersion",component:"Input",label:e("rdm.dataChange.genomeVersion"),rules:[{required:!0,validator:(n,t)=>g(this,null,function*(){return t?t.length>30?Promise.reject(e("AllMessage.RdmTextThree")):Promise.resolve():Promise.reject(e("AllMessage.RdmTextTwo"))}),trigger:"change"}]},{field:"mappingId",component:"InputSearch",componentProps:{loading:T.value,onSearch:()=>{ce()}},label:e("rdm.dataChange.mappingId")},{field:"remarkss",component:"Select",label:e("rdm.dataChange.remarkss"),slot:"ShareOne"}],showActionButtonGroup:!1}),[te,{setTableData:q,getSelectRows:ae,clearSelectedRowKeys:oe}]=J({columns:[{title:e("rdm.dataChange.fileRealName"),dataIndex:"fileRealName"},{title:e("rdm.dataChange.type"),dataIndex:"type"},{title:e("rdm.dataChange.status"),dataIndex:"status",slots:{customRender:"status"}}],afterFetch:n=>(console.log(n),n),bordered:!1,striped:!0,clickToRowSelect:!1,isTreeTable:!1,showTableSetting:!1,showIndexColumn:!1,canResize:!1,ellipsis:!0,actionColumn:{width:200,title:e("rdm.dataChange.action"),slots:{customRender:"action"},fixed:"right"},rowSelection:{type:"checkbox"}}),[ne,{getSelectRows:se,setTableData:re}]=J({columns:[{title:e("rdm.increasedData.ftpPath"),dataIndex:"ftpPath",slots:{customRender:"ftpPath"},width:150},{title:e("rdm.increasedData.ftpPathList"),dataIndex:"ftpPathList",slots:{customRender:"ftpPathList"},width:150},{title:e("rdm.increasedData.organismName"),dataIndex:"organismName",width:150},{title:e("rdm.increasedData.seqRelDate"),dataIndex:"seqRelDate",width:150},{title:e("rdm.increasedData.type"),dataIndex:"type",width:150}],afterFetch:n=>n,dataSource:[],bordered:!1,striped:!0,isTreeTable:!1,showIndexColumn:!1,canResize:!1,ellipsis:!0,rowKey:"ftpPathList",rowSelection:{type:"checkbox"}}),ie=n=>g(this,null,function*(){const t=yield H({id:n.id});Ke({url:t.downloadUrl,target:"_self",fileName:t.fileRealName})}),le=n=>{const t=a.UseRdmFromData.changeto;t.queryAllInfoResponseslist[n].status="uploading",q(t.queryAllInfoResponseslist)},de=n=>{const t=a.UseRdmFromData.changeto;a.UseRdmFromData.changeto.queryAllInfoResponseslist=t.queryAllInfoResponseslist.filter(d=>d.id!=n[0].id),a.UseRdmFromData.changeto[n[0].type]=a.UseRdmFromData.changeto[n[0].type].filter(d=>d.id!=n[0].id),R.value={genomeSequence:t.genomeSequence,genomeAnnotationGff:t.genomeAnnotationGff,genomeAnnotationGtf:t.genomeAnnotationGtf,transcriptSequence:t.transcriptSequence,proteinSequence:t.proteinSequence,other:t.other},q(t.queryAllInfoResponseslist)},ue=()=>g(this,null,function*(){const n=yield Z(),t=se();Ve(j(G(G({},n),R.value),{genomeSequenceNew:a.useRdmUpData.\u57FA\u56E0\u7EC4\u5E8F\u5217,genomeAnnotationGffNew:a.useRdmUpData.\u57FA\u56E0\u7EC4\u6CE8\u91CAgff,genomeAnnotationGtfNew:a.useRdmUpData.\u57FA\u56E0\u7EC4\u6CE8\u91CAgtf,transcriptSequenceNew:a.useRdmUpData.\u8F6C\u5F55\u672C\u5E8F\u5217,proteinSequenceNew:a.useRdmUpData.\u86CB\u767D\u5E8F\u5217,otherNew:a.useRdmUpData.\u5176\u4ED6\u7C7B,id:a.UseRdmFromData.changeto.id,mappingIdSaveRequestList:t})).then(d=>{P.success(e("AllMessage.RdmMessageSuccess"))}),A("/rdm"),Q(),a.SetUseRdmFromData("changeto",{})}),me=n=>g(this,null,function*(){var h;console.log(" ",(h=a.UseRdmFromData)==null?void 0:h.changeto);const t=a.UseRdmFromData.changeto,d=t.queryAllInfoResponseslist.splice(n,1)[0];a.UseRdmFromData.changeto[d.type]=a.UseRdmFromData.changeto[d.type].filter(C=>C.id!=d.id),R.value={genomeSequence:t.genomeSequence,genomeAnnotationGff:t.genomeAnnotationGff,genomeAnnotationGtf:t.genomeAnnotationGtf,transcriptSequence:t.transcriptSequence,proteinSequence:t.proteinSequence,other:t.other},q(t.queryAllInfoResponseslist)}),ce=()=>g(this,null,function*(){c.value=[];const{mappingId:n}=ee();if(!n){P.error(e("AllMessage.RdmMessageError"));return}T.value=!0;const{token:t,tokenKey:d}=yield Je(),C=yield[...new Set([...n.split(",")])].map(r=>g(this,null,function*(){return yield We({assembly_accession:r,token:t,tokenKey:d})})),s=yield Promise.all(C);if(T.value=!1,s.forEach(r=>{const{ftpPath:p,ftpPathList:L,organismName:ge,seqRelDate:fe,subLibrary:he}=r[0],Re=L.map(_=>{const Ce=_.indexOf("genomic.fna")!==-1?"\u57FA\u56E0\u7EC4\u5E8F\u5217":_.indexOf("genomic.gff")!==-1?"\u57FA\u56E0\u7EC4\u6CE8\u91CAgff":_.indexOf("genomic.gtf")!==-1?"\u57FA\u56E0\u7EC4\u6CE8\u91CAgtf":_.indexOf("rna.fna")!==-1?"\u8F6C\u5F55\u7EC4\u5E8F\u5217":_.indexOf("genomic.faa")!==-1?"\u86CB\u767D\u5E8F\u5217":"\u5176\u4ED6\u7C7B";return{seqRelDate:fe,subLibrary:he,organismName:ge,ftpPath:p,ftpPathList:_,type:Ce}});c.value=[...c.value,...Re]}),c.value.length==0){Ie.error(e("AllMessage.RdmMessageErrorTwo"));return}re([...JSON.parse(JSON.stringify(c.value))])}),pe=()=>g(this,null,function*(){const n=yield ae();n.length==0&&P.error(e("AllMessage.PleaseCheckTheFollowingDocumentsInTheForm")),n.forEach((t,d)=>g(this,null,function*(){const h=yield H({id:t.id});Xe(h,d+1>10?1e3:(d+1)*100)})),oe()});return be(()=>g(this,null,function*(){var h,C,s;const n=yield je({id:m.params.id});a.UseRdmFromData.changeto=n.record[0],D.value=n.record[0],a.UseRdmFromData.changeto.queryAllInfoResponseslist=[],["genomeSequence","genomeAnnotationGff","genomeAnnotationGtf","transcriptSequence","proteinSequence","other"].forEach(r=>{a.UseRdmFromData.changeto[r]?(a.UseRdmFromData.changeto[r].map(p=>p.type=r),a.UseRdmFromData.changeto.queryAllInfoResponseslist=a.UseRdmFromData.changeto.queryAllInfoResponseslist.concat(...a.UseRdmFromData.changeto[r])):a.UseRdmFromData.changeto[r]=[]}),Y({species:a.UseRdmFromData.changeto.species,speciesId:a.UseRdmFromData.changeto.speciesId,genomeVersion:a.UseRdmFromData.changeto.genomeVersion,mappingId:a.UseRdmFromData.changeto.mappingId,remarkss:(h=a.UseRdmFromData.changeto.remarks1s)==null?void 0:h.map(r=>r.id)}),q([...((C=a.UseRdmFromData.changeto.queryAllInfoResponseslist)==null?void 0:C.length)&&((s=a.UseRdmFromData.changeto.queryAllInfoResponseslist)==null?void 0:s.length)>0?a.UseRdmFromData.changeto.queryAllInfoResponseslist:[]]),R.value={genomeSequence:a.UseRdmFromData.changeto.genomeSequence,genomeAnnotationGff:a.UseRdmFromData.changeto.genomeAnnotationGff,genomeAnnotationGtf:a.UseRdmFromData.changeto.genomeAnnotationGtf,transcriptSequence:a.UseRdmFromData.changeto.transcriptSequence,proteinSequence:a.UseRdmFromData.changeto.proteinSequence,other:a.UseRdmFromData.changeto.other};const d=yield He();w.value=d,w.value.forEach((r,p)=>{r.label=r.nickname,r.value=r.id,r.key=p}),a.useRdmFileList=[],a.useRdmUpData={\u57FA\u56E0\u7EC4\u5E8F\u5217:[],\u57FA\u56E0\u7EC4\u6CE8\u91CAgff:[],\u57FA\u56E0\u7EC4\u6CE8\u91CAgtf:[],\u8F6C\u5F55\u672C\u5E8F\u5217:[],\u86CB\u767D\u5E8F\u5217:[],\u5176\u4ED6\u7C7B:[]}})),(n,t)=>{const d=N("a-button"),h=N("a-typography-text"),C=N("CustomButton");return x(),U("div",null,[i(o(Me),{class:"high-form"},{default:l(()=>[i(o(I),{title:o(e)("rdm.dataChange.title"),bordered:!1},{extra:l(()=>[f("div",Ye,[i(d,{onClick:t[0]||(t[0]=()=>{o(A)("/rdm"),o(a).useRdmFileList=[]}),style:{color:"#202020",border:"1px solid #666"}},{default:l(()=>[S(F(o(e)("rdm.dataChange.cancel")),1)]),_:1}),i(d,{type:"primary",onClick:ue,style:{background:"#2d54ec",color:"#fff",marginLeft:"20px"}},{default:l(()=>[S(F(o(e)("rdm.dataChange.submit")),1)]),_:1})])]),default:l(()=>[i(o(Be),{onRegister:o(X)},{ShareOne:l(({model:s,field:r})=>[i(o(Ee),{ref:"select",value:s[r],"onUpdate:value":p=>s[r]=p,allowClear:"",mode:"multiple",options:w.value,placeholder:o(e)("common.chooseText"),getPopupContainer:p=>p.parentNode},null,8,["value","onUpdate:value","options","placeholder","getPopupContainer"])]),_:1},8,["onRegister"])]),_:1},8,["title"]),Ze,i(o(I),{title:o(e)("rdm.dataChange.titleTwo")},{default:l(()=>[i(o(B),null,{default:l(()=>[(x(!0),U(V,null,$([{name:"genomeSequence",text:`${o(e)("rdm.dataChange.genomeSequences")}`},{name:"genomeAnnotationGff",text:`${o(e)("rdm.dataChange.genomeAnnotationGffs")}`},{name:"genomeAnnotationGtf",text:`${o(e)("rdm.dataChange.genomeAnnotationGtfs")}`},{name:"transcriptSequence",text:`${o(e)("rdm.dataChange.transcriptSequences")}`},{name:"proteinSequence",text:`${o(e)("rdm.dataChange.proteinSequences")}`},{name:"other",text:`${o(e)("rdm.dataChange.others")}`}],(s,r)=>(x(),Pe(o(b),{span:10,offset:2,key:s.name,style:{margin:"15px"}},{default:l(()=>[i($e,{onCover:de,useRdmFromData:D.value[s.name],title:s.text,toindex:r},null,8,["useRdmFromData","title","toindex"]),i(o(B),null,{default:l(()=>[i(o(b),{span:6,offset:0},{default:l(()=>[(x(!0),U(V,null,$(v.value[r],(p,L)=>(x(),U("div",{style:{width:"427px",height:"40px",lineHeight:"40px",background:"#EDEEF5",borderRadius:"4px",margin:"10px 0",color:"#6387f3"},key:L},[i(o(B),null,{default:l(()=>[i(o(b),{span:1},{default:l(()=>[i(o(Qe))]),_:1}),i(o(b),{span:20},{default:l(()=>[i(h,{style:{width:"100%",color:"#6387f3"},ellipsis:!0,content:p.name},null,8,["content"])]),_:2},1024)]),_:2},1024)]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["title"]),et,i(o(I),{title:o(e)("rdm.dataChange.titleThree")},{default:l(()=>[i(o(W),{onRegister:o(te),onSelectionChange:t[2]||(t[2]=({rows:s})=>{s.length>0?k.value=!1:k.value=!0})},{status:l(({record:s})=>[f("div",tt,[f("div",at,[f("div",{class:Te([s.status?s.status:"default"])},null,2),S(" "+F(s.status=="done"?o(e)("rdm.dataChange.uploadStatusDone"):s.status=="uploading"?o(e)("rdm.dataChange.uploadStatusUploading"):s.status=="suspend"?o(e)("rdm.dataChange.uploadStatusUploadSuspended"):o(e)("rdm.dataChange.uploadStatusUploadNo")),1)])])]),toolbar:l(()=>[i(C,{type:"primary",onClick:t[1]||(t[1]=()=>{pe()}),disabled:k.value,style:{width:"90px",height:"32px",margin:"0px 0px",borderRadius:"4px"}},{default:l(()=>[S(F(o(e)("rdm.check.downs")),1)]),_:1},8,["disabled"])]),action:l(({record:s,index:r})=>[f("div",ot,[z(i(o(ze),{onUpovered:()=>{le(r)},record:s},null,8,["onUpovered","record"]),[[K,s.status=="suspend"]]),i(d,{type:"link",disabled:s.status!=="done",onClick:()=>{ie(s)}},{default:l(()=>[S(F(o(e)("rdm.dataChange.down")),1)]),_:2},1032,["disabled","onClick"]),i(d,{type:"link",onClick:()=>{me(r)}},{default:l(()=>[S(F(o(e)("rdm.dataChange.delete")),1)]),_:2},1032,["onClick"])])]),_:1},8,["onRegister"])]),_:1},8,["title"]),nt,z(f("div",null,[i(o(I),{title:o(e)("rdm.increasedData.titleThree")},{default:l(()=>[i(o(W),{onRegister:o(ne)},{ftpPath:l(({record:s})=>[f("div",null,F(s.ftpPath.slice(s.ftpPath.lastIndexOf("/")+1)),1)]),ftpPathList:l(({record:s})=>[f("div",null,F(s.ftpPathList.slice(s.ftpPathList.lastIndexOf("/")+1)),1)]),_:1},8,["onRegister"])]),_:1},8,["title"])],512),[[K,c.value.length>0]]),st]),_:1})])}}});var aa=Ae(rt,[["__scopeId","data-v-44c56609"]]);export{aa as default};
