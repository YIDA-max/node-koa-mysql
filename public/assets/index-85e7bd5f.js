import{a as b,bv as h,bp as C,J as I,H as E,f7 as N,ax as U,B as p,j as O,o as _,c as W,w as l,b as e,e as r,u as t,k as c,af as i,f as g,F as A,r as D,f8 as P}from"./index-4a8cc517.js";import{T as F}from"./index-878008b6.js";import{P as J}from"./index-e995ff17.js";import"./index-0114aff3.js";import"./index-310f637e.js";import"./useSize-e99e0e82.js";import"./eagerComputed-80ba1157.js";import"./useWindowSizeFn-5faf2053.js";import"./useContentViewHeight-08ed5cff.js";import"./ArrowLeftOutlined-91a2b19b.js";import"./index-1c6e8fcc.js";import"./transButton-0a2e0cd4.js";const M={class:"flex"},R={class:"w-1/3 bg-white p-4"},j={class:"flex items-center"},G=e("span",{class:"text-lg font-medium mr-4"}," 连接状态: ",-1),H=e("hr",{class:"my-4"},null,-1),q={class:"flex"},z=e("p",{class:"text-lg font-medium mt-4"},"设置",-1),K=e("hr",{class:"my-4"},null,-1),Q={class:"w-2/3 bg-white ml-4 p-4"},X=e("span",{class:"text-lg font-medium mr-4"}," 消息记录: ",-1),Y=e("hr",{class:"my-4"},null,-1),Z={class:"max-h-80 overflow-auto"},$={class:"flex items-center"},ee=e("span",{class:"mr-2 text-primary font-medium"},"收到消息:",-1),te=b({name:"InfraWebSocket"}),fe=b({...te,setup(se){const x=h.TextArea,k=C(),s=I({sendValue:"",recordList:[]}),d=E(({}.VITE_GLOB_BASE_URL+"/websocket/message").replace("http","ws")+"?userId="+k.getUserInfo.user.id),{status:f,data:u,send:w,close:y,open:T}=N(d.value,{autoReconnect:!1,heartbeat:!0});U(()=>{if(u.value)try{const m=JSON.parse(u.value);s.recordList.push(m)}catch{s.recordList.push({res:u.value,id:Math.ceil(Math.random()*1e3),time:new Date().getTime()})}});const o=p(()=>f.value==="OPEN"),S=p(()=>o.value?"success":"red"),V=p(()=>[...s.recordList].reverse());function B(){w(s.sendValue),s.sendValue=""}function L(){o.value?y():T()}return(m,n)=>{const v=O("a-button");return _(),W(t(J),{title:"WebSocket 示例"},{default:l(()=>[e("div",M,[e("div",R,[e("div",j,[G,r(t(F),{color:t(S)},{default:l(()=>[c(i(t(f)),1)]),_:1},8,["color"])]),H,e("div",q,[r(t(h),{value:d.value,"onUpdate:value":n[0]||(n[0]=a=>d.value=a),disabled:""},{addonBefore:l(()=>[c(" 服务地址 ")]),_:1},8,["value"]),r(v,{type:t(o)?"danger":"primary",onClick:L},{default:l(()=>[c(i(t(o)?"关闭连接":"开启连接"),1)]),_:1},8,["type"])]),z,K,r(t(x),{placeholder:"需要发送到服务器的内容",disabled:!t(o),value:s.sendValue,"onUpdate:value":n[1]||(n[1]=a=>s.sendValue=a),allowClear:""},null,8,["disabled","value"]),r(v,{type:"primary",block:"",class:"mt-4",disabled:!t(o),onClick:B},{default:l(()=>[c(" 发送 ")]),_:1},8,["disabled"])]),e("div",Q,[X,Y,e("div",Z,[e("ul",null,[(_(!0),g(A,null,D(t(V),a=>(_(),g("li",{class:"mt-2",key:a.time},[e("div",$,[ee,e("span",null,i(t(P)(a.time)),1)]),e("div",null,i(a.res),1)]))),128))])])])])]),_:1})}}});export{fe as default};
