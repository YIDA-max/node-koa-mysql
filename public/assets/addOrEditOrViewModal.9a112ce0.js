var m=(w,p,e)=>new Promise((c,r)=>{var C=i=>{try{f(e.next(i))}catch(g){r(g)}},d=i=>{try{f(e.throw(i))}catch(g){r(g)}},f=i=>i.done?c(i.value):Promise.resolve(i.value).then(C,d);f((e=e.apply(w,p)).next())});import{b as O,B as R}from"./index.c8f8ec06.js";import{u as j,B as T}from"./useForm.98d7b8ca.js";import{a as U,b as G,u as L,r as X,l as W,j as s,aT as S,x as $,o as A,U as x,A as y,e as V,i as P,D as k,t as z,f as H,X as J,B as K,G as Q}from"./index.10ef4608.js";import{b as Y,E as Z}from"./instrument.c1311afa.js";import{c as E}from"./platfrom.439ed019.js";import"./useAttrs.1d381a3e.js";import"./useWindowSizeFn.3e5b045d.js";import"./useModalContext.52c86736.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               */import"./index.b6ac86eb.js";/* empty css                *//* empty css                */import"./uuid.2429c801.js";import"./TableAction.edf9a202.js";/* empty css                */import"./download.66a6d137.js";import"./index.504b494d.js";const ee={style:{position:"relative",top:"50px"}},te={class:"flex justify-end"},se=k("\u786E\u5B9A"),ae=G({__name:"addOrEditOrViewModal",props:{success:{type:Function,required:!0},leiXingCode:{type:Array,required:!0}},setup(w){const p=w,{t:e}=L(),{createMessage:c}=Q(),r=X("add"),C=W(()=>s(r)==="add"?e("AllMessage.cmAdd"):s(r)==="edit"?e("AllMessage.cmEdit"):e("AllMessage.cmView")),d=X(),[f,{closeModal:i}]=O(l=>m(this,[l],function*({statusText:n,record:a}){h(),r.value=n,d.value=a,n=="edit"?setTimeout(()=>{new Promise(t=>{F([{field:"leiXingCode",component:"Select",label:e("cm.instrument.platformName"),slot:"leiXingCode",colProps:{span:24}},{field:"name",component:"Input",label:e("cm.instrument.instrument"),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E"}],componentProps:({formActionType:o})=>({onBlur:S(()=>m(this,null,function*(){try{const{updateSchema:u,validate:v}=o,_={name:d.value.name,type:2,codes:d.value.leiXingCode,id:d.value.id};if(!_.name||!_.codes)return;const b=yield E(_);yield u({field:"name",rules:[{validator:()=>b?Promise.resolve():Promise.reject("\u5DF2\u5B58\u5728"),required:!0}]}),yield v(["name"])}catch(u){console.error(u)}}),100)}),colProps:{span:24}}]),t("edit")}).then(()=>{setTimeout(()=>{const t=[];a.types.forEach((o,u)=>{t.push(o.code)}),M({name:a.name,leiXingCode:t}),B({disabled:!1})},100)})},300):n=="view"?setTimeout(()=>{new Promise(t=>{F([{field:"leiXingCode",component:"Select",label:e("cm.instrument.platformName"),slot:"leiXingCode",colProps:{span:24}},{field:"name",component:"Input",label:e("cm.instrument.instrument"),rules:[],colProps:{span:24}}]),t("view")}).then(()=>{const t=[];a.types.forEach((o,u)=>{t.push(o.code)}),M({name:a.name,leiXingCode:t}),B({disabled:!0})})},300):n=="add"&&setTimeout(()=>{new Promise(t=>{F([{field:"leiXingCode",component:"Select",label:e("cm.instrument.platformName"),slot:"leiXingCode",colProps:{span:24}},{field:"name",component:"Input",label:e("cm.instrument.instrument"),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E"}],componentProps:({formActionType:o,formModel:u})=>({onBlur:S(()=>m(this,null,function*(){try{const{updateSchema:v,validate:_}=o,b={name:u.name,type:2,codes:u.leiXingCode};if(!b.name||!b.codes)return;const I=yield E(b);yield v({field:"name",rules:[{validator:()=>I?Promise.resolve():Promise.reject("\u5DF2\u5B58\u5728"),required:!0}]}),yield _(["name"])}catch(v){console.error(v)}}),100)}),colProps:{span:24}}]),t("add")}).then(()=>{B({disabled:!1})})},300)})),[g,{resetFields:h,getFieldsValue:q,setFieldsValue:M,validate:N,updateSchema:F,setProps:B}]=j({showActionButtonGroup:!1,labelWidth:80,disabled:!1,schemas:[{field:"leiXingCode",component:"Select",label:e("cm.instrument.platformName"),slot:"leiXingCode",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E73\u53F0",type:"array"}],colProps:{span:24}},{field:"name",component:"Input",label:e("cm.instrument.instrument"),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E"},{validator:(n,a)=>m(this,null,function*(){return new Promise((l,t)=>{const o={name:a,type:2,codes:[]};!o.name||!o.codes||E(o).then(()=>{l()}).catch(()=>{t("\u5DF2\u5B58\u5728")})})}),validateTrigger:"blur"}],colProps:{span:24}}]}),D=()=>m(this,null,function*(){try{if(!(yield N()))return;const a=q();if(s(r)==="add"){const l=yield Y(a);l.code===200?c.success(e("AllMessage.successAdd")):c.error(l.msg),p.success()}else if(s(r)==="edit"){a.id=d.value.id;const l=yield Z(a);l.code===200?c.success(e("AllMessage.successEdit")):c.error(l.msg),p.success()}i(),h()}catch(n){console.error(n)}finally{}});return(n,a)=>{const l=$("CustomButton");return A(),x(s(R),K(n.$attrs,{onRegister:s(f),title:s(C)}),{footer:y(()=>[V("div",te,[P(l,{btnStyle:{backgroundColor:"#fff",border:"1px solid rgb(102, 102, 102)",padding:"0px 20px",color:"#000",marginLeft:"10px"},onClick:a[0]||(a[0]=()=>{s(h)(),r.value=="view"?function(){s(i)()}():function(){s(h)()}()})},{default:y(()=>[k(z(r.value=="view"?s(e)("AllMessage.cancel"):s(e)("AllMessage.reset")),1)]),_:1},8,["btnStyle"]),r.value!=="view"?(A(),x(l,{key:0,btnStyle:{backgroundColor:"#2F54EB",padding:"0px 20px",color:"#fff"},onClick:D},{default:y(()=>[se]),_:1})):H("v-if",!0)])]),default:y(()=>[V("div",ee,[P(s(T),{onRegister:s(g),ref:"basicForm"},{leiXingCode:y(({model:t,field:o})=>[P(s(J),{ref:"select",value:t[o],"onUpdate:value":u=>t[o]=u,allowClear:"",mode:"multiple",options:p.leiXingCode,disabled:r.value=="view",placeholder:s(e)("AllMessage.pleaseEnter")},null,8,["value","onUpdate:value","options","disabled","placeholder"])]),_:1},8,["onRegister"])])]),_:1},16,["onRegister","title"])}}});var Xe=U(ae,[["__scopeId","data-v-18da3f98"]]);export{Xe as default};
