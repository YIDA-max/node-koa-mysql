var m=(V,n,E)=>new Promise((r,b)=>{var F=D=>{try{A(E.next(D))}catch(h){b(h)}},C=D=>{try{A(E.throw(D))}catch(h){b(h)}},A=D=>D.done?r(D.value):Promise.resolve(D.value).then(F,C);A((E=E.apply(V,n)).next())});import{r as v,a as ie,b as pe,u as ce,cJ as me,a6 as de,ay as fe,l as ve,aT as ge,bm as he,q as De,x as R,o as P,c as I,i as p,A as c,j as u,cM as ye,e as B,D as M,t as x,X as O,am as Se,cv as Pe,cl as X,I as j,d5 as Ee,ao as be,ap as Fe,U as L,y as we,z as Ve,af as Ae,bN as q,df as H,G as K}from"./index.10ef4608.js";import xe from"./useFromBtn.fc0a7004.js";import Ce from"./DataAndShare.d7c3bfab.js";import{u as _e,B as Ie}from"./useForm.98d7b8ca.js";import{P as Be}from"./index.8d0858e7.js";/* empty css                *//* empty css               *//* empty css               */import{a as U,h as Q}from"./homePage.0537fe58.js";import{a as Oe}from"./platfrom.439ed019.js";import{c as je,q as Ue}from"./instrument.c1311afa.js";import{c as Me}from"./record.74637501.js";import{A as Y}from"./add.f693dce6.js";import{u as Te}from"./useSetFrom.689ec4a2.js";import"./index.b552eb11.js";import"./CustomConfirmModal.3a0fbacc.js";import"./modal-error.7cada6d5.js";import"./upData.1eb30bdf.js";/* empty css                *//* empty css                */import"./spark-md5.2cc5764b.js";import"./updata.d7bd895d.js";import"./download.66a6d137.js";import"./index.cbb3e8f4.js";import"./uuid.2429c801.js";import"./onMountedOrActivated.0d13b2a6.js";import"./LinkOutlined.b4db2572.js";import"./index.024ea322.js";import"./CustomConfirmModal.4993b14f.js";import"./FromItem.81f55d95.js";import"./index.6e25da4f.js";import"./CustomConfirmModal.2d382653.js";import"./FromItem.3558c6ed.js";/* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               */import"./index.b6ac86eb.js";import"./useAttrs.1d381a3e.js";import"./index.c8f8ec06.js";import"./useWindowSizeFn.3e5b045d.js";import"./useModalContext.52c86736.js";import"./TableAction.edf9a202.js";/* empty css                */import"./index.504b494d.js";/* empty css               */import"./useContentViewHeight.9302814f.js";v(0);v(0);v(0);v(null);const ke=V=>V?V.indexOf("\u5176\u4ED6")!==-1:!1;const Ne={style:{width:"200px",display:"flex",justifyContent:"space-around"}},Re={class:"select-wrapper"},Le={style:{padding:"4px 8px",cursor:"pointer"}},qe=M("\u65B0\u5EFA"),We={key:1},$e={key:1},ze=pe({__name:"index",setup(V){const{t:n}=ce(),{hasPermission:E}=me(),r=Te(),b=de(),F=v(),C=v(document.body.offsetWidth),A=(a,{attrs:e})=>e.vnodes,{TextArea:D}=j,h=v(!1),f=v(),y=v(""),w=v(),T=v(),_=v(!1),k=v();fe(()=>k.value,()=>{k.value=="\u5176\u4ED6\u5E73\u53F0(\u81EA\u4E3B\u6DFB\u52A0)"?$([{field:"platformSelectValue",component:"Select",label:n("mom.increasedData.platformSelectValue"),slot:"platformSelectValue",required:!0,colProps:{span:9,offset:2}},{field:"platformInputValue",component:"Input",label:n("mom.increasedData.platformInputValue"),slot:"platformInputValue",labelWidth:80,colProps:{span:8,offset:2}},{field:"instrumentSelectValue",component:"Select",label:n("mom.increasedData.instrumentSelectValue"),slot:"instrumentSelectValue",labelWidth:80,colProps:{span:0,offset:0}},{field:"instrumentInputValue",component:"Input",label:n("mom.increasedData.instrumentInputValue"),slot:"instrumentInputValue",labelWidth:120,colProps:{span:9,offset:2}}]):$([{field:"platformSelectValue",component:"Select",label:n("mom.increasedData.platformSelectValue"),slot:"platformSelectValue",required:!0,colProps:{span:9,offset:2}},{field:"instrumentSelectValue",component:"Select",label:n("mom.increasedData.instrumentSelectValue"),slot:"instrumentSelectValue",colProps:{span:9,offset:1}},{field:"platformInputValue",component:"Input",label:n("mom.increasedData.platformInputValue"),slot:"platformInputValue",colProps:{span:0,offset:0}},{field:"instrumentInputValue",component:"Input",label:n("mom.increasedData.instrumentInputValue"),slot:"instrumentInputValue",colProps:{span:0,offset:0}}])});const Z=ve(()=>{let a=!1;y.value;for(let e=0;e<f.value.length;e++)if(f.value[e].projectName==y.value)a=!0;else{a=!1;break}return a}),W=[{field:"fieldMainProject",component:"Select",label:n("mom.increasedData.fieldMainProject"),labelWidth:120,colProps:{span:19,offset:2},rules:[{required:!0,validator:(a,e)=>m(this,null,function*(){return e?Promise.resolve():Promise.reject("\u9700\u8981\u9009\u62E9\u4E3B\u9879\u76EE")}),trigger:"change"}],componentProps:{options:f},slot:"fieldMainProjectSelect"},{field:"mainProject",component:"Input",label:n("mom.increasedData.mainProject"),componentProps:({formActionType:a,formModel:e})=>({onBlur:ge(()=>m(this,null,function*(){try{const{updateSchema:t,validate:o}=a,g={subproject:e.mainProject},l=yield je(g);yield t({field:"mainProject",rules:[{validator:()=>l?Promise.resolve():Promise.reject("\u5DF2\u5B58\u5728"),required:!0}]}),yield o(["mainProject"])}catch(t){console.error(t)}}),100),allowClear:!0,maxlength:100}),rules:[{required:!0,validator:(a,e)=>m(this,null,function*(){return e?e.length>100?Promise.reject("\u503C\u4E0D\u80FD\u5927\u4E8E50"):Promise.resolve():Promise.reject("\u503C\u4E0D\u80FD\u4E3A\u7A7A")}),trigger:"change"}]},{field:"fieldTpye",component:"Select",slot:"fieldTpye",label:n("mom.increasedData.fieldTpye"),rules:[{required:!0,validator:(a,e)=>m(this,null,function*(){return e?Promise.resolve():Promise.reject("\u9700\u8981\u9009\u62E9\u7C7B\u578B")}),trigger:"change"}],componentProps:{options:F}},{field:"mappingID",component:"Input",label:n("mom.increasedData.mappingID"),componentProps:{allowClear:!0},rules:[{validator:(a,e)=>m(this,null,function*(){if(e){if(e.length>50)return Promise.reject("\u503C\u4E0D\u80FD\u5927\u4E8E50")}else return Promise.resolve()}),trigger:"change"}]},{field:"species",component:"Input",label:n("mom.increasedData.species"),componentProps:{allowClear:!0},rules:[{validator:(a,e)=>m(this,null,function*(){if(e){if(e.length>50)return Promise.reject("\u503C\u4E0D\u80FD\u5927\u4E8E50")}else return Promise.resolve()}),trigger:"change"}]},{field:"collectdDate",component:"DatePicker",componentProps:function(){return{style:{width:"100%"}}},label:n("mom.increasedData.collectdDate"),colProps:{span:19,offset:2}},{field:"SamplingLocation",component:"Input",label:n("mom.increasedData.SamplingLocation"),componentProps:{allowClear:!0},rules:[{validator:(a,e)=>m(this,null,function*(){if(e){if(e.length>50)return Promise.reject("\u503C\u4E0D\u80FD\u5927\u4E8E50")}else return Promise.resolve()}),trigger:"change"}]},{field:"SampleType",component:"Input",label:n("mom.increasedData.SampleType"),componentProps:{allowClear:!0},rules:[{validator:(a,e)=>m(this,null,function*(){if(e){if(e.length>50)return Promise.reject("\u503C\u4E0D\u80FD\u5927\u4E8E50")}else return Promise.resolve()}),trigger:"change"}]},{field:"platformSelectValue",component:"Select",label:n("mom.increasedData.platformSelectValue"),slot:"platformSelectValue",rules:[{required:!0}],colProps:{span:9,offset:2}},{field:"platformInputValue",component:"Input",label:n("mom.increasedData.platformInputValue"),slot:"platformInputValue",colProps:{span:0,offset:0}},{field:"instrumentSelectValue",component:"Select",label:n("mom.increasedData.instrumentSelectValue"),slot:"instrumentSelectValue",colProps:{span:9,offset:1}},{field:"instrumentInputValue",component:"Input",label:n("mom.increasedData.instrumentInputValue"),slot:"instrumentInputValue",colProps:{span:0,offset:0}},{field:"textDesignInfo",component:"Input",label:n("mom.increasedData.textDesignInfo"),render:({model:a,field:e})=>he(D,{placeholder:n("AllMessage.pleaseEnter"),value:a[e],maxlength:300,onChange:t=>{a[e]=t.target.value},autoSize:{minRows:2,maxRows:4}}),componentProps:{allowClear:!0},rules:[{required:!0}]},{field:"dataType",component:"RadioGroup",label:n("mom.increasedData.dataType"),rules:[{required:!0}],defaultValue:!1,dynamicDisabled:()=>!E("mom:transform"),componentProps:{options:[{label:n("mom.increasedData.dataTypePublic"),value:!0},{label:n("mom.increasedData.dataTypePrivate"),value:!1}]}}];W.forEach(a=>a.dynamicRules=e=>ne(e));const[ee,{validate:ae,updateSchema:$,validateFields:te}]=_e({labelWidth:120,baseColProps:{span:19,offset:2},schemas:W,showActionButtonGroup:!1}),z=v(null),J=v(null);function oe(){return m(this,null,function*(){try{const a=yield z.value.DataAndShareSubmitAll(),e=yield J.value.FromBtnSubmitAll(),t=yield ae(),o=[],g=[],l=[],i=[],s=[],S=[];Object.keys(a).forEach(d=>{d.indexOf("DataOwnerEmail")!==-1?o.push(a[d]):d.indexOf("DataOwnerPhone")!==-1?g.push(a[d]):d.indexOf("DataOwner")!==-1&&S.push(a[d]),d.indexOf("ShareOneEmail")!==-1?l.push(a[d]):d.indexOf("ShareOnePhone")!==-1?i.push(a[d]):d.indexOf("ShareOne")!==-1&&s.push(a[d])}),r.SetSetUseUpBigData();const G={articleContent:e.tinymce,collectionTime:new Date(t.collectdDate),dataOwner:[...S[0]],dataType:t.dataType,experimentalDesign:t.textDesignInfo,instrument:t.instrumentSelectValue,mappingId:t.mappingID,masterProject:t.fieldMainProject,otherInstrument:t.instrumentInputValue,otherOwnersEmail:o,otherOwnersPhone:g,otherPlatforms:t.platformInputValue,otherSharerEmail:l,otherSharerPhone:i,otherInformation:JSON.stringify(r.useDataOwner),shareInformation:JSON.stringify(r.useShare),platform:t.platformSelectValue,sampleType:t.SampleType,samplingPlace:t.SamplingLocation,sharer:[...s[0]],species:t.species,subproject:t.mainProject,type:t.fieldTpye,dataDescriptionTable:r.useUpData?JSON.stringify(r.useUpData):"",rawDatas:r.useUpBigData.length>0?r.useUpBigData:[]};_.value=!0,r.useFileList=[],r.addAddDataOwnerinfo=[],r.addShareinfo=[],r.useUpBigData.length==0?q.confirm({title:p("div",{style:{}},"\u60A8\u5C1A\u672A\u4E0A\u4F20\u539F\u59CB\u5927\u6587\u4EF6\u6216\u8005\u5927\u6587\u4EF6\u5C1A\u672A\u5206\u6790\u5B8C\u6210,\u662F\u5426\u786E\u8BA4\u63D0\u4EA4?"),icon:p(H),centered:!0,onOk:function(){return m(this,null,function*(){const d=yield Y(G),{createMessage:N}=K();return N.success(`${d.success?"\u6DFB\u52A0\u6210\u529F":"\u6DFB\u52A0\u5931\u8D25"}`),r.resetuseUpBigData(),r.useUpData=[],r.useFileList=[],d.success&&b("/mom"),Promise.resolve()})},onCancel(){return _.value=!1,Promise.resolve()}}):q.confirm({title:p("div",{style:{}},"\u6E29\u99A8\u63D0\u793A\uFF1A\u6587\u4EF6\u4F20\u8F93\u671F\u95F4\uFF0C\u5982\u679C\u5237\u65B0\u7F51\u9875\u6216\u8005\u5173\u95ED\u7F51\u9875\uFF0C\u4F1A\u5BFC\u81F4\u4F20\u8F93\u4E2D\u65AD\uFF0C\u9700\u8981\u91CD\u65B0\u7EED\u4F20\u3002"),icon:p(H),centered:!0,onOk:function(){return m(this,null,function*(){const d=yield Y(G),{createMessage:N}=K();N.success(`${d.success?"\u6DFB\u52A0\u6210\u529F":"\u6DFB\u52A0\u5931\u8D25"}`),r.resetuseUpBigData(),r.useUpData=[],r.useFileList=[],d.success&&b("/mom")})},onCancel(){_.value=!1,q.destroyAll()}})}catch(a){console.log(a),r.SetSetUseUpBigData(),console.log(" ",r.useUpBigData)}})}const le=a=>m(this,null,function*(){if(a!="\u5176\u4ED6\u5E73\u53F0(\u81EA\u4E3B\u6DFB\u52A0)"){const e=yield Ue({types:[a]});T.value=e,T.value.forEach((t,o)=>{t.label=t.name,t.value=t.code,t.key=o})}}),ne=a=>{const e=a.schema.field;a.values[e]&&te([e]);const o=a.schema.rules;return o&&(o[0].validator||(o[0].validator=(g,l)=>m(this,null,function*(){return(typeof l=="boolean"?String(l):l)?Promise.resolve():Promise.reject(`\u8BF7\u8F93\u5165${a.schema.label}`)})),o)},ue=a=>m(this,null,function*(){const e=yield Oe({types:[a]});w.value=e,w.value.forEach((t,o)=>{t.label=t.name,t.value=t.code,t.key=o}),w.value.push({label:"\u5176\u4ED6\u5E73\u53F0(\u81EA\u4E3B\u6DFB\u52A0)",value:"\u5176\u4ED6\u5E73\u53F0(\u81EA\u4E3B\u6DFB\u52A0)"})}),re=()=>m(this,null,function*(){if(f.value.length==0&&(f.value=yield U({meaning:"multiomics_Management_type"}),f.value.forEach((a,e)=>{a.label=a.projectName,a.value=a.id,a.key=e})),y.value=="")f.value=yield U({meaning:"multiomics_Management_type"}),f.value.forEach((a,e)=>{a.label=a.projectName,a.value=a.id,a.key=e});else{const a=[];f.value.forEach((e,t)=>{e.projectName.indexOf(y.value)!=-1&&(e.label=e.projectName,e.value=e.id,e.key=t,a.push(e))}),f.value=a}}),se=()=>m(this,null,function*(){Me({projectName:`${y.value}`,projectDescribe:"\u9ED8\u8BA4\u7559\u8A00"}),setTimeout(()=>m(this,null,function*(){f.value=yield U({meaning:"multiomics_Management_type"}),f.value.forEach((a,e)=>{a.label=a.projectName,a.value=a.id,a.key=e}),y.value=""}),500)});return De(()=>m(this,null,function*(){window.addEventListener("resize",()=>{C.value=document.body.offsetWidth,console.log(C.value)});const a=yield U({meaning:"multiomics_Management_type"});f.value=a,f.value.forEach((o,g)=>{o.label=o.projectName,o.value=o.id,o.key=g});const e=yield Q({meaning:"multiomics_Management_type"});F.value=e,F.value.forEach((o,g)=>{o.label=o.name,o.value=o.code,o.key=g});const t=yield Q({meaning:""});w.value=t,w.value.forEach((o,g)=>{o.label=o.name,o.value=o.code,o.key=g}),r.resetuseUpBigData(),r.useUpData=[],r.useFileList=[[],[]],r.useDataOwner=[],r.useShare=[],document.querySelectorAll(".ant-input-affix-wrapper").forEach(o=>o.style.marginTop="-2px"),document.querySelectorAll(".ant-calendar-picker-default").forEach(o=>o.style.marginTop="-2px")})),(a,e)=>{const t=R("a-button"),o=R("a-divider"),g=R("a-select-option");return P(),I("div",null,[p(u(Ae),{spinning:_.value},{default:c(()=>[p(u(Be),{class:"high-form"},{default:c(()=>[p(u(ye),{title:u(n)("mom.increasedData.title"),bordered:!1},{extra:c(()=>[B("div",Ne,[p(t,{type:"primary",onClick:e[0]||(e[0]=()=>{u(b)("/mom"),u(r).useFileList=[],u(r).addAddDataOwnerinfo=[],u(r).addShareinfo=[],u(r).resetuseUpBigData(),u(r).useUpData=[],u(r).useFileList=[]}),style:{background:"#fff",fontSize:"12px",width:"110px",color:"#202020",border:"1px solid #666666",margin:"0px 0px",marginRight:"20px",borderRadius:"4px"}},{default:c(()=>[M(x(u(n)("mom.increasedData.cancel")),1)]),_:1}),p(t,{type:"primary",onClick:oe,style:{background:"#2d54ec",fontSize:"12px",color:"#fff",width:"110px",margin:"0px 0px",borderRadius:"4px"}},{default:c(()=>[M(x(u(n)("mom.increasedData.submit")),1)]),_:1})])]),default:c(()=>[p(u(Ie),{class:"from-wrapper",onRegister:u(ee)},{fieldMainProjectSelect:c(({model:l,field:i})=>[B("div",Re,[p(u(O),{dropdownClassName:"dropdown-class-name",placeholder:u(n)("AllMessage.pleaseChoose"),open:h.value,onSelect:e[5]||(e[5]=()=>{h.value=!1}),value:l[i],"onUpdate:value":s=>l[i]=s,getPopupContainer:s=>s.parentElement,class:Se({"ant-select-open":h.value}),"option-label-prop":"label","filter-option":(s,S)=>S.componentOptions.propsData.label.toLowerCase().indexOf(s.toLowerCase())>=0,"show-search":""},{dropdownRender:c(({menuNode:s})=>[p(o,{style:{margin:"4px 0"}}),B("div",Le,[p(u(Pe),{style:{padding:"10px"}},{default:c(()=>[p(u(X),{span:20},{default:c(()=>[p(u(j),{value:y.value,"onUpdate:value":e[1]||(e[1]=S=>y.value=S),allowClear:"",placeholder:u(n)("AllMessage.SearchingProjects"),onChange:e[2]||(e[2]=()=>{re()}),onClick:e[3]||(e[3]=S=>S.target.focus()),maxlength:50},{prefix:c(()=>[p(u(Ee))]),_:1},8,["value","placeholder"])]),_:1}),p(u(X),{span:4},{default:c(()=>[p(t,{type:"link",disabled:u(Z)||y.value=="",onClick:e[4]||(e[4]=()=>{se()})},{default:c(()=>[qe]),_:1},8,["disabled"])]),_:1})]),_:1}),p(A,{vnodes:s},null,8,["vnodes"])])]),default:c(()=>[(P(!0),I(be,null,Fe(f.value,s=>(P(),L(g,{key:s.id,value:s.id,label:s.projectName},{default:c(()=>[M(x(s.projectName),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["placeholder","open","value","onUpdate:value","getPopupContainer","class","filter-option"]),we(B("div",{class:"select_overlap",onMouseup:e[6]||(e[6]=()=>{h.value=!h.value})},null,544),[[Ve,!h.value]])])]),fieldTpye:c(({model:l,field:i})=>[p(u(O),{ref:"select",value:l[i],"onUpdate:value":s=>l[i]=s,options:F.value,getPopupContainer:s=>s.parentElement,onChange:()=>{ue(l[i]),l.instrumentSelectValue=[],l.platformInputValue="",l.instrumentInputValue="",l.platformSelectValue=""}},null,8,["value","onUpdate:value","options","getPopupContainer","onChange"])]),platformSelectValue:c(({model:l,field:i})=>[p(u(O),{ref:"select",getPopupContainer:s=>s.parentElement,style:{width:"100%"},value:l[i],"onUpdate:value":s=>l[i]=s,options:w.value,placeholder:u(n)("AllMessage.pleaseChoose"),onChange:()=>{k.value=l[i],le(l[i]),l.instrumentSelectValue=[],l.platformInputValue="",l.instrumentInputValue=""}},null,8,["getPopupContainer","value","onUpdate:value","options","placeholder","onChange"])]),platformInputValue:c(({model:l,field:i})=>[l.platformSelectValue=="\u5176\u4ED6\u5E73\u53F0(\u81EA\u4E3B\u6DFB\u52A0)"?(P(),L(u(j),{key:0,style:{borderRadius:"1px",border:"1px solid #D6D8E0",width:"100%"},maxlength:50,value:l[i],"onUpdate:value":s=>l[i]=s},null,8,["value","onUpdate:value"])):(P(),I("div",We,x(u(n)("AllMessage.platformMessage")),1))]),instrumentSelectValue:c(({model:l,field:i})=>[p(u(O),{ref:"select",value:l[i],"onUpdate:value":s=>l[i]=s,getPopupContainer:s=>s.parentElement,style:{borderRadius:"1px",width:"100%",border:"none !important"},id:"instrumentstyle",allowClear:"",mode:"multiple",options:T.value,placeholder:u(n)("AllMessage.pleaseChoose")},null,8,["value","onUpdate:value","getPopupContainer","options","placeholder"])]),instrumentInputValue:c(({model:l,field:i})=>[u(ke)(l.platformSelectValue)?(P(),L(u(j),{key:0,style:{borderRadius:"1px",border:"1px solid #D6D8E0",width:"100%"},maxlength:50,value:l[i],"onUpdate:value":s=>l[i]=s},null,8,["value","onUpdate:value"])):(P(),I("div",$e,x(u(n)("AllMessage.instrumentMessage")),1))]),_:1},8,["onRegister"]),p(Ce,{ref_key:"DataAndShareRef",ref:z},null,512),p(xe,{ref_key:"useFromBtnRef",ref:J},null,512)]),_:1},8,["title"])]),_:1})]),_:1},8,["spinning"])])}}});var qa=ie(ze,[["__scopeId","data-v-c4c5bc90"]]);export{qa as default};
